.\" Automatically generated by Pod::Man 2.22 (Pod::Simple 3.07)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\" ========================================================================
.\"
.IX Title "SUDOERS.LDAP 5"
.TH SUDOERS.LDAP 5 "2011-04-21" "1.7.4p4-2.squeeze.2" "SUDO"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
sudoers.ldap \- Configuration LDAP pour sudo
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
En complément du fichier \fIsudoers\fR standard, \fBsudo\fR peut être configuré
par \s-1LDAP\s0. Cela peut être particulièrement utile pour synchroniser \fIsudoers\fR
dans un environnement largement distribué.
.PP
Utiliser \s-1LDAP\s0 pour \fIsudoers\fR présente plusieurs avantages :
.IP "\(bu" 4
\&\fBsudo\fR no longer needs to read \fIsudoers\fR in its entirety.  When \s-1LDAP\s0 is
used, there are only two or three \s-1LDAP\s0 queries per invocation.  This makes
it especially fast and particularly usable in \s-1LDAP\s0 environments.
.IP "\(bu" 4
\&\fBsudo\fR ne quitte plus s'il existe une faute de frappe dans \fIsudoers\fR. Il
n'est pas possible de charger des données \s-1LDAP\s0 dans le serveur qui ne se
conforment pas au schéma sudoers, ainsi une syntaxe propre est garantie. Il
est toujours possible d'avoir des fautes de frappes dans un nom
d'utilisateur ou de machine, mais ceci n'empêchera pas \fBsudo\fR de
fonctionner.
.IP "\(bu" 4
It is possible to specify per-entry options that override the global default
options.  \fI\f(CI@sysconfdir\fI@/sudoers\fR only supports default options and limited
options associated with user/host/commands/aliases.  The syntax is
complicated and can be difficult for users to understand.  Placing the
options directly in the entry is more natural.
.IP "\(bu" 4
Le programme \fBvisudo\fR n'est plus nécessaire. \fBvisudo\fR fournit un
verrouillage et une vérification de syntaxe du fichier
<@sysconfdir@/sudoers>. Étant donné que les mises à jour \s-1LDAP\s0 sont
atomiques, le verrouillage n'est plus nécessaire. Parce que la syntaxe est
vérifiée lorsque les données sont insérées dans \s-1LDAP\s0, il n'y a pas besoin
d'un outil spécialisé pour vérifier la syntaxe.
.PP
Une autre différence majeure entre \s-1LDAP\s0 et le fichier \fIsudoers\fR est que
dans \s-1LDAP\s0, les alias spécifiques \fBsudo\fR ne sont pas supportés.
.PP
Dans la plupart des cas, il n'y a pas réellement besoin des alias
spécifiques \fBsudo\fR. Les groupes Unix ou bien les groupes réseaux
utilisateurs (« users netgroups ») peuvent être utilisés en lieu et place de
« User_Aliases » et de « RunasAliases ». Les groupes réseaux machines («
host netgroups ») peuvent être utilisé en lieu et place de «
HostAliases ». Étant donné que les groupes Unix et les groupes réseaux
peuvent êtres stockés dans \s-1LDAP\s0, il n'y a pas de besoin réel pour les alias
spécifiques \fBsudo\fR.
.PP
Cmnd_Aliases are not really required either since it is possible to have
multiple users listed in a sudoRole.  Instead of defining a Cmnd_Alias that
is referenced by multiple users, one can create a sudoRole that contains the
commands and assign multiple users to it.
.SS "SUDOers \s-1LDAP\s0 container"
.IX Subsection "SUDOers LDAP container"
La configuration \fIsudoers\fR est contenue dans le conteneur \s-1LDAP\s0
\&\f(CW\*(C`ou=SUDOers\*(C'\fR.
.PP
Sudo cherche en premier une entrée \f(CW\*(C`cn=defaults\*(C'\fR dans le conteneur
SUDOers. Si une entrée est trouvée, l'attribut multivalué \f(CW\*(C`sudoOption\*(C'\fR est
analysé de la même manière que la ligne de configuration globale \f(CW\*(C`Defaults\*(C'\fR
dans \fI\f(CI@sysconfdir\fI@/sudoers\fR. Dans l'exemple suivant, la variable
\&\f(CW\*(C`SSH_AUTH_SOCK\*(C'\fR sera préservée dans l'environnement pour tous les
utilisateurs.
.PP
.Vb 6
\&    dn: cn=defaults,ou=SUDOers,dc=example,dc=com
\&    objectClass: top
\&    objectClass: sudoRole
\&    cn: defaults
\&    description: Default sudoOption\*(Aqs go here
\&    sudoOption: env_keep+=SSH_AUTH_SOCK
.Ve
.PP
L'équivalent d'un sudoer dans \s-1LDAP\s0 est un \f(CW\*(C`sudoRole\*(C'\fR. Il est constitué des
composants suivants :
.IP "\fBsudoUser\fR" 4
.IX Item "sudoUser"
Un nom d'utilisateur, un uid (préfixé avec \f(CW\*(Aq#\*(Aq\fR), un groupe Unix (préfixé
avec un \f(CW\*(Aq%\*(Aq\fR) ou un « netgroup » utilisateur (préfixé avec un \f(CW\*(Aq+\*(Aq\fR).
.IP "\fBsudoHost\fR" 4
.IX Item "sudoHost"
Un nom d'hôte, une adresse \s-1IP\s0; un réseau \s-1IP\s0, ou bien un « netgroup » machine
(préfixé avec un \f(CW\*(Aq+\*(Aq\fR). La valeur spéciale \f(CW\*(C`ALL\*(C'\fR correspondra à n'importe
quel hôte.
.IP "\fBsudoCommand\fR" 4
.IX Item "sudoCommand"
Une commande Unix avec des paramètres optionnels passés en ligne de
commande, incluant potentiellement des caractères permettant de représenter
des motifs (connus également sous le nom de caractères de remplacement). La
valeur spéciale \f(CW\*(C`ALL\*(C'\fR correspondra à n'importe quelle commande. \s-1SI\s0 une
commande est préfixée avec un point d'exclamation \f(CW\*(Aq!\*(Aq\fR, l'utilisateur sera
interdit d'exécuter cette commande.
.IP "\fBsudoOption\fR" 4
.IX Item "sudoOption"
Identique en fonction des options globales décrites ci-dessus, mais
spécifique au \f(CW\*(C`sudoRole\*(C'\fR dans lequel il réside.
.IP "\fBsudoRunAsUser\fR" 4
.IX Item "sudoRunAsUser"
Un nom d'utilisateur ou uid (préfixé avec <'#'> en tant que lequel les
commandes peuvent être exécutées ou bien un groupe Unix (préfixé avec
\&\f(CW\*(Aq%\*(Aq\fR) ou un « netgroup » utilisateur (préfixé avec un \f(CW\*(Aq+\*(Aq\fR) contenant
une liste d'utilisateurs en tant que lesquels les commandes peuvent être
exécutées. La valeur spéciale \f(CW\*(C`ALL\*(C'\fR correspondra à n'importe quel
utilisateur.
.IP "\fBsudoRunAsGroup\fR" 4
.IX Item "sudoRunAsGroup"
Un groupe Unix ou un gid (préfixé avec \f(CW\*(Aq#\*(Aq\fR) en tant que lequel les
commandes peuvent être exécutées. La valeur spéciale \f(CW\*(C`ALL\*(C'\fR correspondra à
n'importe quel groupe.
.PP
Each component listed above should contain a single value, but there may be
multiple instances of each component type.  A sudoRole must contain at least
one \f(CW\*(C`sudoUser\*(C'\fR, \f(CW\*(C`sudoHost\*(C'\fR and \f(CW\*(C`sudoCommand\*(C'\fR.
.PP
L'exemple suivant permet aux utilisateurs du groupe wheel d'exécuter
n'importe quelle commande sur n'importe quel hôte par \fBsudo\fR :
.PP
.Vb 7
\&    dn: cn=%wheel,ou=SUDOers,dc=example,dc=com
\&    objectClass: top
\&    objectClass: sudoRole
\&    cn: %wheel
\&    sudoUser: %wheel
\&    sudoHost: ALL
\&    sudoCommand: ALL
.Ve
.SS "Anatomie d'une recherche sudoers \s-1LDAP\s0"
.IX Subsection "Anatomie d'une recherche sudoers LDAP"
Lorsque vous cherchez un sudoer utilisant \s-1LDAP\s0 il y a seulement deux ou
trois requêtes \s-1LDAP\s0 par appel. La première requête consiste à analyser les
options globales. La seconde est la correspondance entre le nom
d'utilisateur et les groupes auquel l'utilisateur appartient. (La balise
spéciale \s-1ALL\s0 correspond à cette requête aussi.) Si aucune correspondance
n'est retournée pour le nom d'utilisateur et les groupes, une troisième
requête renvoie toutes les entrées contenant des « netgroups » utilisateurs
et vérifie si l'utilisateur appartient à l'un d'eux.
.SS "Différences entre les sudoers \s-1LDAP\s0 et non-LDAP"
.IX Subsection "Différences entre les sudoers LDAP et non-LDAP"
Il y a de subtiles différences dans la manière dont les sudoers sont
manipulés une fois dans \s-1LDAP\s0. Probablement, la plus importante est que
conformément à la \s-1RFC\s0, le classement fait par \s-1LDAP\s0 est arbitraire et que
vous ne pouvez pas vous attendre à ce que les attributs et les entrées
soient retournés dans un ordre spécifique. S'il y a des règles de gestion en
conflit sur une entrée, la négative passe en priorité. Ceci est appelé le
comportement paranoïaque (pas nécessairement la correspondance la plus
spécifique).
.PP
Voici un exemple :
.PP
.Vb 5
\&    # /etc/sudoers:
\&    # Autorise toutes les commandes sauf l\*(Aqinterpréteurl
\&    johnny  ALL=(root) ALL,!/bin/sh
\&    # Autorise toute les commandes parce que la correspondance sur ALL est faite en derniert
\&    puddles ALL=(root) !/bin/sh,ALL
\&
\&    # Équivalence LDAP pour johnny
\&    # Autorise toutes les commandes sauf l\*(Aqinterpréteur
\&    dn: cn=role1,ou=Sudoers,dc=mon\-domaine,dc=com
\&    objectClass: sudoRole
\&    objectClass: top
\&    cn: role1
\&    sudoUser: johnny
\&    sudoHost: ALL
\&    sudoCommand: ALL
\&    sudoCommand: !/bin/sh
\&
\&    # LDAP equivalent of puddles
\&    # Notice that even though ALL comes last, it still behaves like
\&    # role1 since the LDAP code assumes the more paranoid configuration
\&    dn: cn=role2,ou=Sudoers,dc=my\-domain,dc=com
\&    objectClass: sudoRole
\&    objectClass: top
\&    cn: role2
\&    sudoUser: puddles
\&    sudoHost: ALL
\&    sudoCommand: !/bin/sh
\&    sudoCommand: ALL
.Ve
.PP
Another difference is that negations on the Host, User or Runas are
currently ignorred.  For example, the following attributes do not behave the
way one might expect.
.PP
.Vb 3
\&    # ne correspond pas à S<« Tout> le monde sauf S<joe »>
\&    # mais plutôt , ne correspond à personne
\&    sudoUser: !joe
\&
\&    # ne correspond pas à S<« tout> le monde sauf S<joe »>
\&    # mais plutôt, correspond à S<« tout> le monde y compris S<joe »>
\&    sudoUser: ALL
\&    sudoUser: !joe
\&
\&    # does not match all but web01
\&    # rather, matches all hosts including web01
\&    sudoHost: ALL
\&    sudoHost: !web01
.Ve
.SS "Schema Sudoers"
.IX Subsection "Schema Sudoers"
Afin d'utiliser le support \s-1LDAP\s0 de \fBsudo\fR, le schéma \fBsudo\fR doit être
installé sur votre serveur \s-1LDAP\s0. De plus, soyez sur d'indexer l'attribut
« sudoUser ».
.PP
Trois versions du schéma :une pour les serveurs OpenLDAP
(<schema.OpenLDAP>), une pour les serveurs dérivés de celui de Netscape
(\fIschema.iPlanet\fR), et une pour Microsoft Active Directory
(<schema.ActiveDirectory>) peuvent êtres trouvées dans la distribution de
\&\fBsudo\fR.
.PP
Le schéma pour \fBsudo\fR sous la forme OpenLDAP est inclus dans la section
\&\s-1EXAMPLES\s0.
.SS "Configuration de ldap.conf"
.IX Subsection "Configuration de ldap.conf"
Sudo lit le fichier <@ldap_conf@> pour la configuration spécifique
\&\s-1LDAP\s0. Typiquement, ce fichier est partagé parmi les différents clients
utilisant \s-1LDAP\s0. Comme tel, la plupart des réglages ne sont pas spécifiques à
\&\fBsudo\fR. A noter que B.<sudo> analyse \fI\f(CI@ldap_conf\fI@\fR lui\-même et peut
supporter des options qui diffèrent de celles décrites dans le manuel de
\&\fIldap.conf\fR\|(5).
.PP
A noter aussi que sur des systèmes utilisant les librairies OpenLDAP, les
valeurs par défaut précisées dans \fI/etc/openldap/ldap.conf\fR ou dans le
fichier \fI.ldaprc\fR de l'utilisateur ne sont pas utilisées.
.PP
Uniquement ces options là explicitement listées dans \fI\f(CI@ldap_conf\fI@\fR qui sont
supportées par \fBsudo\fR sont honorées. Les options de configurations sont
listées ci-dessous en majuscules mais sont analysées de manière insensible à
la casse.
.IP "\fB\s-1URI\s0\fR ldap[s]://[nom d'hôte[:port]] ..." 4
.IX Item "URI ldap[s]://[nom d'hôte[:port]] ..."
Spécifie une liste avec un espace blanc comme délimiteur d'une ou plusieurs
URIs décrivant le(s) serveur(s) a(ux)quel(s) se connecter. Le \fIprotocol\fR
peut être soit \fBldap\fR ou bien \fBldaps\fR, ce dernier étant pour les serveurs
qui supportent le chiffrement \s-1TLS\s0(\s-1SSL\s0). Si aucun port n'est précisé, le port
par défaut est 389 pour \f(CW\*(C`ldap://\*(C'\fR ou 636 pour \f(CW\*(C`ldaps://\*(C'\fR. Si aucun nom
d'hôte n'est précisé, \fBsudo\fR se connectera à \fBlocalhost\fR. Les lignes
\&\fB\s-1URI\s0\fR multiples sont traitées identiquement à une seule ligne \fB\s-1URI\s0\fR
contenant de multiples entrées. Seuls les systèmes utilisant les libraires
OpenSSL supportent le mélange d'URIs \f(CW\*(C`ldap://\*(C'\fR et \f(CW\*(C`ldaps://\*(C'\fR. Les
librairies dérivées de Netscape utilisés sur la plupart des versions
commeciales d'Unix sont uniquement capables de supporter l'un ou l'autre.
.IP "\fB\s-1HOST\s0\fR nom[:port] ..." 4
.IX Item "HOST nom[:port] ..."
Si aucune \fB\s-1URI\s0\fR n'est précisée, le paramètre \fB\s-1HOST\s0\fR précise une liste avec
un espace blanc comme délimiteur de serveurs \s-1LDAP\s0 auxquels se
connecter. Chaque hôte, peut inclure un \fIport\fR optionnel séparé par
deux-points (« : »). Le paramètre \fB\s-1HOST\s0\fR est déprécié en faveur de la
spécification \fB\s-1URI\s0\fR et est inclus pour des raisons de compatibilité
descendante.
.IP "\fB\s-1PORT\s0\fR numéro de port" 4
.IX Item "PORT numéro de port"
Si aucune \fB\s-1URI\s0\fR n'est précisée, le paramètre B précise le port par défaut
pour se connecter à un serveur \s-1LDAP\s0 si un paramètre \fB\s-1HOST\s0\fR ne précise pas
lui\-même le port. Si aucun paramètre \fB\s-1PORT\s0\fR n'est précisé, le port par
défaut est 389 pour \s-1LDAP\s0 et 636 pour \s-1LDAP\s0 au-dessus de \s-1TLS\s0 (\s-1SSL\s0). Le \fB\s-1PORT\s0\fR
paramètre est déprécié en faveur de la spécification \fB\s-1URI\s0\fR et est inclus
pour des raisons de compatibilité descendante.
.IP "\fB\s-1BIND_TIMELIMIT\s0\fR secondes" 4
.IX Item "BIND_TIMELIMIT secondes"
Le paramètre \fB\s-1BIND_TIMELIMIT\s0\fR précise la durée, en secondes, à attendre
pour se connecter à un serveur \s-1LDAP\s0. Si de multiples \fB\s-1URI\s0\fR ou \fB\s-1HOST\s0\fR sont
définis, ceci est la durée à attendre avant d'essayer de se connecter au
prochain dans la liste.
.IP "\fB\s-1TIMELIMIT\s0\fR seconds" 4
.IX Item "TIMELIMIT seconds"
Le paramètre \fB\s-1TIMELIMIT\s0\fR définit la durée, en secondes, à attendre pour
pour une réponse à une requête \s-1LDAP\s0.
.IP "\fB\s-1SUDOERS_BASE\s0\fR base" 4
.IX Item "SUDOERS_BASE base"
Le \s-1DN\s0 de base à utiliser lors de la réalisation des requêtes \s-1LDAP\s0 de
\&\fBsudo\fR. Typiquement, ceci est de la forme \f(CW\*(C`ou=SUDOers,dc=exemple,dc=com\*(C'\fR
pour le domaine \f(CW\*(C`exemple.com\*(C'\fR. Plusieurs lignes \fB\s-1SUDOERS_BASE\s0\fR peut être
précisées, ce qui fait que dans ce cas , ils seront interrogés dans l'ordre
précisé.
.IP "\fB\s-1SUDOERS_DEBUG\s0\fR niveau de debug" 4
.IX Item "SUDOERS_DEBUG niveau de debug"
Ceci définit le niveau de débogage pour les requêtes \s-1LDAP\s0 de
\&\fBsudo\fR. L'information de débogage est affichée sur l'erreur standard. Une
valeur de 1 a pour résultat une quantité d'information de débogage
modérée. Une valeur de 2 montre les résultats des correspondances. Ce
paramètre ne devrait pas être défini dans un environnement de production vu
que l'information supplémentaire a tendance a troubler les utilisateurs.
.IP "\fB\s-1BINDDN\s0\fR \s-1DN\s0" 4
.IX Item "BINDDN DN"
Le paramètre \fB\s-1BINDDN\s0\fR spécifie, sous la forme d'un Distinguished Name (\s-1DN\s0),
l'identité à utiliser pour effectuer des opérations \s-1LDAP\s0. Si ce n'est pas
spécifié, les opérations \s-1LDAP\s0 seront réalisées avec une identité
anonyme. Par défaut, la plupart des serveurs \s-1LDAP\s0 autorisent l'accès
anonyme.
.IP "\fB\s-1BINDPW\s0\fR secret" 4
.IX Item "BINDPW secret"
The \fB\s-1BINDPW\s0\fR parameter specifies the password to use when performing \s-1LDAP\s0
operations.  This is typically used in conjunction with the \fB\s-1BINDDN\s0\fR
parameter.
.IP "\fB\s-1ROOTBINDDN\s0\fR \s-1DN\s0" 4
.IX Item "ROOTBINDDN DN"
The \fB\s-1ROOTBINDDN\s0\fR parameter specifies the identity, in the form of a
Distinguished Name (\s-1DN\s0), to use when performing privileged \s-1LDAP\s0 operations,
such as \fIsudoers\fR queries.  The password corresponding to the identity
should be stored in \fI\f(CI@ldap_secret\fI@\fR.  If not specified, the \fB\s-1BINDDN\s0\fR
identity is used (if any).
.IP "\fB\s-1LDAP_VERSION\s0\fR number" 4
.IX Item "LDAP_VERSION number"
The version of the \s-1LDAP\s0 protocol to use when connecting to the server.  The
default value is protocol version 3.
.IP "\fB\s-1SSL\s0\fR on/true/yes/off/false/no" 4
.IX Item "SSL on/true/yes/off/false/no"
If the \fB\s-1SSL\s0\fR parameter is set to \f(CW\*(C`on\*(C'\fR, \f(CW\*(C`true\*(C'\fR or \f(CW\*(C`yes\*(C'\fR, \s-1TLS\s0 (\s-1SSL\s0)
encryption is always used when communicating with the \s-1LDAP\s0 server.
Typically, this involves connecting to the server on port 636 (ldaps).
.IP "\fB\s-1SSL\s0\fR start_tls" 4
.IX Item "SSL start_tls"
If the \fB\s-1SSL\s0\fR parameter is set to \f(CW\*(C`start_tls\*(C'\fR, the \s-1LDAP\s0 server connection
is initiated normally and \s-1TLS\s0 encryption is begun before the bind
credentials are sent.  This has the advantage of not requiring a dedicated
port for encrypted communications.  This parameter is only supported by \s-1LDAP\s0
servers that honor the \f(CW\*(C`start_tls\*(C'\fR extension, such as the OpenLDAP server.
.IP "\fB\s-1TLS_CHECKPEER\s0\fR on/true/yes/off/false/no" 4
.IX Item "TLS_CHECKPEER on/true/yes/off/false/no"
If enabled, \fB\s-1TLS_CHECKPEER\s0\fR will cause the \s-1LDAP\s0 server's \s-1TLS\s0 certificated
to be verified.  If the server's \s-1TLS\s0 certificate cannot be verified (usually
because it is signed by an unknown certificate authority), \fBsudo\fR will be
unable to connect to it.  If \fB\s-1TLS_CHECKPEER\s0\fR is disabled, no check is
made.  Note that disabling the check creates an opportunity for
man-in-the-middle attacks since the server's identity will not be
authenticated.  If possible, the \s-1CA\s0's certificate should be installed
locally so it can be verified.
.IP "\fB\s-1TLS_CACERT\s0\fR file name" 4
.IX Item "TLS_CACERT file name"
An alias for \fB\s-1TLS_CACERTFILE\s0\fR.
.IP "\fB\s-1TLS_CACERTFILE\s0\fR file name" 4
.IX Item "TLS_CACERTFILE file name"
The path to a certificate authority bundle which contains the certificates
for all the Certificate Authorities the client knows to be valid,
e.g. \fI/etc/ssl/ca\-bundle.pem\fR.  This option is only supported by the
OpenLDAP libraries.  Netscape-derived \s-1LDAP\s0 libraries use the same
certificate database for \s-1CA\s0 and client certificates (see \fB\s-1TLS_CERT\s0\fR).
.IP "\fB\s-1TLS_CACERTDIR\s0\fR directory" 4
.IX Item "TLS_CACERTDIR directory"
Similar to \fB\s-1TLS_CACERTFILE\s0\fR but instead of a file, it is a directory
containing individual Certificate Authority certificates,
e.g. \fI/etc/ssl/certs\fR.  The directory specified by \fB\s-1TLS_CACERTDIR\s0\fR is
checked after \fB\s-1TLS_CACERTFILE\s0\fR.  This option is only supported by the
OpenLDAP libraries.
.IP "\fB\s-1TLS_CERT\s0\fR file name" 4
.IX Item "TLS_CERT file name"
The path to a file containing the client certificate which can be used to
authenticate the client to the \s-1LDAP\s0 server.  The certificate type depends on
the \s-1LDAP\s0 libraries used.
.Sp
OpenLDAP:
    \f(CW\*(C`tls_cert /etc/ssl/client_cert.pem\*(C'\fR
.Sp
Netscape-derived:
    \f(CW\*(C`tls_cert /var/ldap/cert7.db\*(C'\fR
.Sp
When using Netscape-derived libraries, this file may also contain
Certificate Authority certificates.
.IP "\fB\s-1TLS_KEY\s0\fR file name" 4
.IX Item "TLS_KEY file name"
The path to a file containing the private key which matches the certificate
specified by \fB\s-1TLS_CERT\s0\fR.  The private key must not be password-protected.
The key type depends on the \s-1LDAP\s0 libraries used.
.Sp
OpenLDAP:
    \f(CW\*(C`tls_key /etc/ssl/client_key.pem\*(C'\fR
.Sp
Netscape-derived:
    \f(CW\*(C`tls_key /var/ldap/key3.db\*(C'\fR
.IP "\fB\s-1TLS_RANDFILE\s0\fR file name" 4
.IX Item "TLS_RANDFILE file name"
The \fB\s-1TLS_RANDFILE\s0\fR parameter specifies the path to an entropy source for
systems that lack a random device.  It is generally used in conjunction with
\&\fIprngd\fR or \fIegd\fR.  This option is only supported by the OpenLDAP
libraries.
.IP "\fB\s-1TLS_CIPHERS\s0\fR cipher list" 4
.IX Item "TLS_CIPHERS cipher list"
The \fB\s-1TLS_CIPHERS\s0\fR parameter allows the administer to restrict which
encryption algorithms may be used for \s-1TLS\s0 (\s-1SSL\s0) connections.  See the
OpenSSL manual for a list of valid ciphers.  This option is only supported
by the OpenLDAP libraries.
.IP "\fB\s-1USE_SASL\s0\fR on/true/yes/off/false/no" 4
.IX Item "USE_SASL on/true/yes/off/false/no"
Enable \fB\s-1USE_SASL\s0\fR for \s-1LDAP\s0 servers that support \s-1SASL\s0 authentication.
.IP "\fB\s-1SASL_AUTH_ID\s0\fR identity" 4
.IX Item "SASL_AUTH_ID identity"
The \s-1SASL\s0 user name to use when connecting to the \s-1LDAP\s0 server.  By default,
\&\fBsudo\fR will use an anonymous connection.
.IP "\fB\s-1ROOTUSE_SASL\s0\fR on/true/yes/off/false/no" 4
.IX Item "ROOTUSE_SASL on/true/yes/off/false/no"
Enable \fB\s-1ROOTUSE_SASL\s0\fR to enable \s-1SASL\s0 authentication when connecting to an
\&\s-1LDAP\s0 server from a privileged process, such as \fBsudo\fR.
.IP "\fB\s-1ROOTSASL_AUTH_ID\s0\fR identity" 4
.IX Item "ROOTSASL_AUTH_ID identity"
The \s-1SASL\s0 user name to use when \fB\s-1ROOTUSE_SASL\s0\fR is enabled.
.IP "\fB\s-1SASL_SECPROPS\s0\fR none/properties" 4
.IX Item "SASL_SECPROPS none/properties"
\&\s-1SASL\s0 security properties or \fInone\fR for no properties.  See the \s-1SASL\s0
programmer's manual for details.
.IP "\fB\s-1KRB5_CCNAME\s0\fR file name" 4
.IX Item "KRB5_CCNAME file name"
The path to the Kerberos 5 credential cache to use when authenticating with
the remote server.
.PP
See the \f(CW\*(C`ldap.conf\*(C'\fR entry in the \s-1EXAMPLES\s0 section.
.SS "Configuring nsswitch.conf"
.IX Subsection "Configuring nsswitch.conf"
Unless it is disabled at build time, \fBsudo\fR consults the Name Service
Switch file, \fI\f(CI@nsswitch_conf\fI@\fR, to specify the \fIsudoers\fR search order.
Sudo looks for a line beginning with \f(CW\*(C`sudoers\*(C'\fR: and uses this to determine
the search order.  Note that \fBsudo\fR does not stop searching after the first
match and later matches take precedence over earlier ones.
.PP
The following sources are recognized:
.PP
.Vb 2
\&    files       read sudoers from F<@sysconfdir@/sudoers>
\&    ldap        read sudoers from LDAP
.Ve
.PP
In addition, the entry \f(CW\*(C`[NOTFOUND=return]\*(C'\fR will short-circuit the search if
the user was not found in the preceding source.
.PP
To consult \s-1LDAP\s0 first followed by the local sudoers file (if it exists),
use:
.PP
.Vb 1
\&    sudoers: ldap files
.Ve
.PP
The local \fIsudoers\fR file can be ignored completely by using:
.PP
.Vb 1
\&    sudoers: ldap
.Ve
.PP
If the \fI\f(CI@nsswitch_conf\fI@\fR file is not present or there is no sudoers line,
the following default is assumed:
.PP
.Vb 1
\&    sudoers: files
.Ve
.PP
Note that \fI\f(CI@nsswitch_conf\fI@\fR is supported even when the underlying operating
system does not use an nsswitch.conf file.
.SS "Configuring netsvc.conf"
.IX Subsection "Configuring netsvc.conf"
On \s-1AIX\s0 systems, the \fI\f(CI@netsvc_conf\fI@\fR file is consulted instead of
\&\fI\f(CI@nsswitch_conf\fI@\fR.  \fBsudo\fR simply treats \fInetsvc.conf\fR as a variant of
\&\fInsswitch.conf\fR; information in the previous section unrelated to the file
format itself still applies.
.PP
To consult \s-1LDAP\s0 first followed by the local sudoers file (if it exists),
use:
.PP
.Vb 1
\&    sudoers = ldap, files
.Ve
.PP
The local \fIsudoers\fR file can be ignored completely by using:
.PP
.Vb 1
\&    sudoers = ldap
.Ve
.PP
To treat \s-1LDAP\s0 as authoratative and only use the local sudoers file if the
user is not present in \s-1LDAP\s0, use:
.PP
.Vb 1
\&    sudoers = ldap = auth, files
.Ve
.PP
Note that in the above example, the \f(CW\*(C`auth\*(C'\fR qualfier only affects user
lookups; both \s-1LDAP\s0 and \fIsudoers\fR will be queried for \f(CW\*(C`Defaults\*(C'\fR entries.
.PP
If the \fI\f(CI@netsvc_conf\fI@\fR file is not present or there is no sudoers line, the
following default is assumed:
.PP
.Vb 1
\&    sudoers = files
.Ve
.SH "FILES"
.IX Header "FILES"
.ie n .IP "\fI\fI@ldap_conf\fI@\fR" 24
.el .IP "\fI\f(CI@ldap_conf\fI@\fR" 24
.IX Item "@ldap_conf@"
\&\s-1LDAP\s0 configuration file
.ie n .IP "\fI\fI@nsswitch_conf\fI@\fR" 24
.el .IP "\fI\f(CI@nsswitch_conf\fI@\fR" 24
.IX Item "@nsswitch_conf@"
determines sudoers source order
.ie n .IP "\fI\fI@netsvc_conf\fI@\fR" 24
.el .IP "\fI\f(CI@netsvc_conf\fI@\fR" 24
.IX Item "@netsvc_conf@"
determines sudoers source order on \s-1AIX\s0
.SH "EXAMPLES"
.IX Header "EXAMPLES"
.SS "Example ldap.conf"
.IX Subsection "Example ldap.conf"
.Vb 10
\&  # Either specify one or more URIs or one or more host:port pairs.
\&  # If neither is specified sudo will default to localhost, port 389.
\&  #
\&  #host          ldapserver
\&  #host          ldapserver1 ldapserver2:390
\&  #
\&  # Default port if host is specified without one, defaults to 389.
\&  #port          389
\&  #
\&  # URI will override the host and port settings.
\&  uri            ldap://ldapserver
\&  #uri            ldaps://secureldapserver
\&  #uri            ldaps://secureldapserver ldap://ldapserver
\&  #
\&  # The amount of time, in seconds, to wait while trying to connect to
\&  # an LDAP server.
\&  bind_timelimit 30
\&  #
\&  # The amount of time, in seconds, to wait while performing an LDAP query.
\&  timelimit 30
\&  #
\&  # Must be set or sudo will ignore LDAP; may be specified multiple times.
\&  sudoers_base   ou=SUDOers,dc=example,dc=com
\&  #
\&  # verbose sudoers matching from ldap
\&  #sudoers_debug 2
\&  #
\&  # optional proxy credentials
\&  #binddn        <who to search as>
\&  #bindpw        <password>
\&  #rootbinddn    <who to search as, uses /etc/ldap.secret for bindpw>
\&  #
\&  # LDAP protocol version, defaults to 3
\&  #ldap_version 3
\&  #
\&  # Define if you want to use an encrypted LDAP connection.
\&  # Typically, you must also set the port to 636 (ldaps).
\&  #ssl on
\&  #
\&  # Define if you want to use port 389 and switch to
\&  # encryption before the bind credentials are sent.
\&  # Only supported by LDAP servers that support the start_tls
\&  # extension such as OpenLDAP.
\&  #ssl start_tls
\&  #
\&  # Additional TLS options follow that allow tweaking of the
\&  # SSL/TLS connection.
\&  #
\&  #tls_checkpeer yes # verify server SSL certificate
\&  #tls_checkpeer no  # ignore server SSL certificate
\&  #
\&  # If you enable tls_checkpeer, specify either tls_cacertfile
\&  # or tls_cacertdir.  Only supported when using OpenLDAP.
\&  #
\&  #tls_cacertfile /etc/certs/trusted_signers.pem
\&  #tls_cacertdir  /etc/certs
\&  #
\&  # For systems that don\*(Aqt have /dev/random
\&  # use this along with PRNGD or EGD.pl to seed the
\&  # random number pool to generate cryptographic session keys.
\&  # Only supported when using OpenLDAP.
\&  #
\&  #tls_randfile /etc/egd\-pool
\&  #
\&  # You may restrict which ciphers are used.  Consult your SSL
\&  # documentation for which options go here.
\&  # Only supported when using OpenLDAP.
\&  #
\&  #tls_ciphers <cipher\-list>
\&  #
\&  # Sudo can provide a client certificate when communicating to
\&  # the LDAP server.
\&  # Tips:
\&  #   * Enable both lines at the same time.
\&  #   * Do not password protect the key file.
\&  #   * Ensure the keyfile is only readable by root.
\&  #
\&  # For OpenLDAP:
\&  #tls_cert /etc/certs/client_cert.pem
\&  #tls_key  /etc/certs/client_key.pem
\&  #
\&  # For SunONE or iPlanet LDAP, tls_cert and tls_key may specify either
\&  # a directory, in which case the files in the directory must have the
\&  # default names (e.g. cert8.db and key4.db), or the path to the cert
\&  # and key files themselves.  However, a bug in version 5.0 of the LDAP
\&  # SDK will prevent specific file names from working.  For this reason
\&  # it is suggested that tls_cert and tls_key be set to a directory,
\&  # not a file name.
\&  #
\&  # The certificate database specified by tls_cert may contain CA certs
\&  # and/or the client\*(Aqs cert.  If the client\*(Aqs cert is included, tls_key
\&  # should be specified as well.
\&  # For backward compatibility, "sslpath" may be used in place of tls_cert.
\&  #tls_cert /var/ldap
\&  #tls_key /var/ldap
\&  #
\&  # If using SASL authentication for LDAP (OpenSSL)
\&  # use_sasl yes
\&  # sasl_auth_id <SASL user name>
\&  # rootuse_sasl yes
\&  # rootsasl_auth_id <SASL user name for root access>
\&  # sasl_secprops none
\&  # krb5_ccname /etc/.ldapcache
.Ve
.SS "Sudo schema for OpenLDAP"
.IX Subsection "Sudo schema for OpenLDAP"
The following schema is in OpenLDAP format.  Simply copy it to the schema
directory (e.g. \fI/etc/openldap/schema\fR), add the proper \f(CW\*(C`include\*(C'\fR line in
\&\f(CW\*(C`slapd.conf\*(C'\fR and restart \fBslapd\fR.
.PP
.Vb 6
\& attributetype ( 1.3.6.1.4.1.15953.9.1.1
\&    NAME \*(AqsudoUser\*(Aq
\&    DESC \*(AqUser(s) who may  run sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SUBSTR caseExactIA5SubstringsMatch
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.2
\&    NAME \*(AqsudoHost\*(Aq
\&    DESC \*(AqHost(s) who may run sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SUBSTR caseExactIA5SubstringsMatch
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.3
\&    NAME \*(AqsudoCommand\*(Aq
\&    DESC \*(AqCommand(s) to be executed by sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.4
\&    NAME \*(AqsudoRunAs\*(Aq
\&    DESC \*(AqUser(s) impersonated by sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.5
\&    NAME \*(AqsudoOption\*(Aq
\&    DESC \*(AqOptions(s) followed by sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.6
\&    NAME \*(AqsudoRunAsUser\*(Aq
\&    DESC \*(AqUser(s) impersonated by sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& attributetype ( 1.3.6.1.4.1.15953.9.1.7
\&    NAME \*(AqsudoRunAsGroup\*(Aq
\&    DESC \*(AqGroup(s) impersonated by sudo\*(Aq
\&    EQUALITY caseExactIA5Match
\&    SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
\&
\& objectclass ( 1.3.6.1.4.1.15953.9.2.1 NAME \*(AqsudoRole\*(Aq SUP top STRUCTURAL
\&    DESC \*(AqSudoer Entries\*(Aq
\&    MUST ( cn )
\&    MAY ( sudoUser $ sudoHost $ sudoCommand $ sudoRunAs $ sudoRunAsUser $
\&          sudoRunAsGroup $ sudoOption $ description )
\&    )
.Ve
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIldap.conf\fR\|(5), \fIsudoers\fR\|(5)
.SH "CAVEATS"
.IX Header "CAVEATS"
The way that \fIsudoers\fR is parsed differs between Note that there are
differences in the way that LDAP-based \fIsudoers\fR is parsed compared to
file-based \fIsudoers\fR.  See the \*(L"Differences between \s-1LDAP\s0 and non-LDAP
sudoers\*(R" section for more information.
.SH "BUGS"
.IX Header "BUGS"
If you feel you have found a bug in \fBsudo\fR, please submit a bug report at
http://www.sudo.ws/sudo/bugs/
.SH "SUPPORT"
.IX Header "SUPPORT"
Limited free support is available via the sudo-users mailing list, see
http://www.sudo.ws/mailman/listinfo/sudo\-users to subscribe or search the
archives.
.SH "DISCLAIMER"
.IX Header "DISCLAIMER"
\&\fBsudo\fR is provided ``\s-1AS\s0 \s-1IS\s0'' and any express or implied warranties,
including, but not limited to, the implied warranties of merchantability and
fitness for a particular purpose are disclaimed.  See the \s-1LICENSE\s0 file
distributed with \fBsudo\fR or http://www.sudo.ws/sudo/license.html for
complete details.
