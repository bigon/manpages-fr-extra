.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (c) 1992 Drew Eckhardt (drew@cs.colorado.edu), March 28, 1992
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Modified by Michael Haardt (u31b3hs@pool.informatik.rwth-aachen.de)
.\" Modified Fri Jul 23 21:26:27 1993 by Rik Faith (faith@cs.unc.edu)
.\" Modified 21 Aug 1994 by Michael Chastain (mec@shell.portal.com):
.\"   Fixed necessary '#include' lines.
.\" Modified 15 Apr 1995 by Michael Chastain (mec@shell.portal.com):
.\"   Added reference to adjtimex.
.\" Removed some nonsense lines pointed out by urs@isnogud.escape.de (Urs Thuermann),
.\"   aeb, 950722.
.\"
.\" 
.\" Traduction  10/10/1996 Christophe BLAESS (ccb@club-internet.fr)
.\" Mise a jour 23/01/97
.\" Mise a jour 8/04/97
.\" Mise a jour 28/04/98 (LDP-man-pages-1.19)
.\" Mise a jour 30/05/01 (LDP-man-pages-1.36)
.\" màj 19/01/2002 LDP 1.47
.\" màj 18/07/2003 LDP 1.56
.TH GETTIMEOFDAY 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
gettimeofday, settimeofday \- Lire / écrire l'heure actuelle.
.SH SYNOPSIS
.B #include <sys/time.h>
.sp
.BI "int gettimeofday(struct timeval *" tv ", struct timezone *" tz );
.br
.BI "int settimeofday(const struct timeval *" tv
.BI ", const struct timezone *" tz );
.SH DESCRIPTION
Les fonctions
.B gettimeofday
et
.B settimeofday
servent à lire ou programmer l'heure ainsi que le fuseau horaire (timezone).
L'argument
.I tv
est une structure
.B timeval 
décrite dans /usr/include/sys/time.h :
.sp
.nf
struct timeval {
.in +8
int  tv_sec;  /* secondes */
int  tv_usec; /* microsecondes */
.in -8
};
.fi
.sp
et donne le nombre de secondes et microsecondes écoulées depuis le 1er janvier 1970 (voir 
.BR time (2)).
L'argument
.I tz
est une structure 
.B timezone
composée ainsi\ :
.sp
.nf
struct timezone {
.in +8
int tz_minuteswest; /* minutes à l'ouest de Greenwich  */
int tz_dsttime;     /* type de changement horaire      */
};
.in -8
.fi
.PP
L'utilisation de la structure timezone est obsolète, le champ
.I tz_dsttime
n'a jamais été utilisé sous Linux, il n'a jamais été géré, et
ne le sera jamais par la libc ou glibc.
Toute occurrence de ce champ dans les sources du noyau (sauf
pour les déclarations) est un bug. Ainsi le paragraphe suivant
n'a qu'un intérêt historique.

Le champ
.I tz_dsttime
contient une constante symbolique (dont les valeurs sont fournies
ci-dessous) qui indique quelle partie du changement horaire annuel
est en cours.
(Remarque : Cette valeur est constante tout au long de l'année, elle
n'indique pas réellement la valeur horaire en cours, elle sélectionne
un algorithme).
Les changements horaires (Daylight saving - DST) sont
définis comme suit :
.PP
.ta 14
\fBDST_NONE\fP    /* Aucun */
.br
\fBDST_USA\fP     /* USA */
.br
\fBDST_AUST\fP    /* Australie */
.br
\fBDST_WET\fP     /* Europe occidentale */
.br
\fBDST_MET\fP     /* Europe centrale */
.br
\fBDST_EET\fP     /* Europe Orientale */
.br
\fBDST_CAN\fP     /* Canada */
.br
\fBDST_GB\fP      /* Grande-Bretagne et Irlande */
.br
\fBDST_RUM\fP     /* Roumanie */
.br
\fBDST_TUR\fP     /* Turquie */
.br
\fBDST_AUSTALT\fP /* Australie avec décalage en 1986 */
.PP
Il est évident que le décalage horaire en cours ne peut pas
être uniquement fourni par un algorithme par pays. Ce décalage
dépend de décisions politiques imprévisibles. Ainsi cette méthode
des fuseaux horaires a été abandonnée.
Sous Linux, durant un appel à
.B settimeofday
le champ
.I tz_dsttime
doit être nul.
.PP
Sous Linux, il existe une sémantique particulière associée à l'appel
système
.B settimeofday
si, durant la première invocation (après le boot), il a un argument
.I tz
non-NULL, un argument
.I tv
NULL et un champ
.I tz_minuteswest
différent de zéro. Dans ce cas, on suppose que l'horloge CMOS de la
machine est configurée sur le temps local, et que l'on doit l'augmenter
de cette valeur pour obtenir le temps UTC.
Bien entendu, il faut éviter autant que possible d'utiliser cette particularité.
.PP
Les macros suivantes permettent de manipuler les structures timeval :
.br
.nf
#define	timerisset(tvp)\\
.ti +8
((tvp)->tv_sec || (tvp)->tv_usec)
#define	timercmp(tvp, uvp, cmp)\\
.in +8
((tvp)->tv_sec cmp (uvp)->tv_sec ||\\
(tvp)->tv_sec == (uvp)->tv_sec &&\\
(tvp)->tv_usec cmp (uvp)->tv_usec)
.in -8
#define timerclear(tvp)\\
.ti +8
((tvp)->tv_sec = (tvp)->tv_usec = 0)
.fi
.PP
Si
.I tv
ou 
.I tz
est nulle, la structure correspondante n'est ni programmée ni renvoyée.
.PP
Seul le Super\-User peut appeler
.BR settimeofday .
.SH "VALEUR RENVOYÉE"
.B gettimeofday
et
.B settimeofday
renvoient 0 s'ils réussissent, ou -1 s'ils échouent, auquel
cas
.I errno
contient le code d'erreur.
.SH ERREURS
.TP
.B EPERM 
.B settimeofday
est appelé par quelqu'un d'autre que le Super\-User
.TP
.B EINVAL
le fuseau horaire (ou autre chose) est invalide.
.B EFAULT
.I tv
ou
.I tz
pointent en dehors de l'espace d'adressage autorisé.
.SH NOTE
Le prototype de
.B settimeofday
et les définitions de
.BR timercmp ,
.BR timerisset ,
.BR timerclear ,
.BR timeradd ,
.BR timersub
sont (depuis GlibC 2.2.2) disponibles uniquement si
.B _BSD_SOURCE
est défini (explicitement ou implicitement en ne définissant pas
_POSIX_SOURCE ou en utilisant l'option de compilation -ansi).
.SH "CONFORMITÉ"
SVr4, BSD 4.3
.SH "VOIR AUSSI"
.BR date (1),
.BR adjtimex (2),
.BR time (2),
.BR ctime (3),
.BR ftime (3)
.SH TRADUCTION
Christophe Blaess, 1996-2003.
