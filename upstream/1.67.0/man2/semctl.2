.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 15/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" Màj 08/04/1997
.\" Màj 04/06/2001 LDP-1.36
.\" Màj 20/01/2002 LDP-1.47
.\" Màj 18/07/2003 LDP-1.56
.\" Màj 20/07/2005 LDP-1.64
.\" Màj 14/12/2005 LDP-1.65
.\"
.TH SEMCTL 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
semctl \- Opérations de contrôle sur les sémaphores.
.SH SYNOPSIS
.nf
.B #include <sys/types.h>
.B #include <sys/ipc.h>
.B #include <sys/sem.h>
.sp
.BI "int semctl (int " semid ", int " semno ", int " cmd ", ...);"
.fi
.SH DESCRIPTION
Cette fonction effectue l'opération de contrôle indiquée par
.I cmd
sur l'ensemble de sémaphores (ou sur le
.IR semno\-ième
sémaphore de l'ensemble) identifié par
.IR semid ,
(les sémaphores sont numérotés à partir de zéro).
.PP
Cette fonction prend trois ou quatre arguments. Lorsqu'il y en a quatre,
l'appel est
.BI semctl ( semid , semno , cmd , arg );
où l'argument
.I arg
est de type
.B union semun
défini ainsi\ :

.nf
#if defined(__GNU_LIBRARY__) && !defined(_SEM_SEMUN_UNDEFINED)
/* l'union semun est définie par l'inclusion de <sys/sem.h> */
#else
/* d'après X/OPEN il faut la définir nous-mêmes */
union semun {
      int val;                  /* valeur pour SETVAL */
      struct semid_ds *buf;     /* buffer pour IPC_STAT, IPC_SET */
      unsigned short *array;    /* table  pour GETALL, SETALL */
                                /* Spécificité Linux : */
      struct seminfo *__buf;    /* buffer pour IPC_INFO */
};
#endif
.fi
.PP
Les valeurs autorisées pour l'opération
.I cmd
sont :
.TP 12
.B IPC_STAT
copier dans la structure pointée par
.IB arg .buf
la structure de données concernant l'ensemble de sémaphores.
L'argument
.I semno
est alors ignoré.
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores
.TP
.B IPC_SET
Fixer la valeur de certains champs de la structure
.B semid_ds
pointée par
.IB arg .buf
dans la structure de contrôle de l'ensemble de sémaphores, en mettant à jour
son membre
.B sem_ctime.
Les champs de la structure
.B "struct semid_ds"
fournie dans
.IB arg .buf
et copiés dans la structure de l'ensemble sont :
.nf
.sp
.ft B
	sem_perm.uid
	sem_perm.gid
	sem_perm.mode	\fR/* 9 bits poids faibles*/\fP
.fi
.ft R
.sp
L'UID effectif du processus appelant doit être soit
celui du Super\-User
soit celui du créateur ou du propriétaire
du jeu de sémaphores.
L'argument
.I semno
est ignoré.
.TP
.B IPC_RMID
Supprimer immédiatement l'ensemble de sémaphores en réveillant
tous les processus  en attente. Ils obtiendront un code d'erreur, et
.B errno
aura la valeur
.BR EIDRM.
L'UID effectif du processus appelant doit être soit celui
du Super\-User
soit celui du créateur ou du propriétaire du jeu de sémaphores.
L'argument
.I semno
est ignoré.
.TP
.B GETALL
Renvoyer la valeur
.B semval
de chaque sémaphore de l'ensemble dans le tableau
.IB arg .array \fR.
L'argument
.I semno
est ignoré.
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores.
.TP
.B GETNCNT
Renvoyer la valeur de
.B semncnt
pour le
.IR semno\-ième
sémaphore de l'ensemble
(i.e. le nombre de processus en attente d'une incrémentation du
champ
.B semval
du
.IR semno\-ième
sémaphore).
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores.
.TP
.B GETPID
Renvoyer la valeur de
.B sempid
pour le
.IR semno\-ième
sémaphore de l'ensemble
(i.e. le PID du processus ayant exécute le dernier appel
système
.B semop
sur le
.IR semno\-ième
sémaphore).
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores.
.TP
.B GETVAL
Renvoyer la valeur du champ
.B semval
du
.IR semno\-ième
sémaphore de l'ensemble
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores.
.TP
.B GETZCNT
Renvoyer la valeur du champ
.B semzcnt
du
.IR semno\-ième
sémaphore de l'ensemble.
(i.e. le nombre de processus attendant que le champ
.B semval
du
.IR semno\-ième
sémaphore revienne à 0).
Le processus appelant doit avoir des privilèges de lecture
sur le jeu de sémaphores.
.TP
.B SETALL
Positionner le champ
.B semval
de tous les sémaphores de l'ensemble en utilisant le tableau
.IB arg .array
et en mettant à jour le champ
.B sem_ctime
de la structure
.B semid_ds
de contrôle du jeu de sémaphores.
Les processus en attente sont réveillés si
.B semval
devient 0 ou augmente.
L'argument
.I semno
est ignoré.
Le processus appelant doit avoir des privilèges d'écriture
sur le jeu de sémaphores.
.TP
.B SETVAL
Placer la valeur
.IB arg .val
dans le champ
.B semval
du
.IR semno\-ième
sémaphore de l'ensemble en mettant à jour
le champ
.B sem_ctime
dans la structure
.B semid_ds
associée au jeu de sémaphores.
Le processus appelant doit avoir des privilèges d'écriture
sur le jeu de sémaphores
Les processus en attente sont réveillés si
.B semval
devient 0 ou augmente.
.SH "VALEUR RENVOYÉE"
En cas d'échec, l'appel-système renvoie
.B \-1
et
.B errno
contient le code d'erreur.
Autrement, l'appel-système renvoie une valeur non\-négative
dépendant de l'argument
.I cmd :
.TP 11
.B GETNCNT
la valeur de
.BR semncnt .
.TP
.B GETPID
La valeur
.BR sempid .
.TP
.B GETVAL
La valeur
.BR semval .
.TP
.B GETZCNT
La valeur
.BR semzcnt .
.LP
Toutes les autres commandes
.I cmd
renvoient zéro en cas de réussite.
.SH ERREURS
.B EACCES
Le processus appelant n'a pas les privilèges nécessaires pour
exécuter la commande
.IR cmd .
.TP
.B EFAULT
.IB arg .buf
ou
.IB arg .array
pointent en dehors de l'espace d'adressage accessible.
.TP
.B EIDRM
L'ensemble de sémaphores a été supprimé.
.TP
.B EINVAL
.I cmd
ou
.IR semid
a une valeur illégale.
.TP
.B EPERM
L'argument
.I cmd
réclame les commandes
.B IPC_SET
ou
.B IPC_RMID
mais l'UID effectif du processus appelant n'a pas
les privilèges adéquats.
.TP
.B ERANGE
l'argument
.I cmd
réclame les commandes
.B SETALL
ou
.B SETVAL
et la valeur de
.B semval
(pour l'ensemble ou pour certains sémaphores) est inférieure
à 0 ou supérieur à la valeur
.BR SEMVMX .
.SH NOTES
Les appels-système
.BR IPC_INFO ,
.BR SEM_STAT
et
.B SEM_INFO
sont utilisés par le programme
.BR ipcs (8)
pour fournir des informations sur les ressources allouées.
Ceci peut changer dans le futur, en utilisant l'interface
d'un système de fichiers proc.
.LP
Divers champs de la \fIstruct semid_ds\fP étaient des shorts sous Linux 2.2
et sont devenus longs sous Linux 2.4. Pour en tirer parti, une recompilation
sous GlibC 2.1.91 ou ultérieure doit suffire.
(Le noyau distingue les anciens et nouveaux appels par un drapeau IPC_64
dans
.IR cmd .)
.PP
La limite suivante influe sur l'appel-système
.BR semctl " :"
.TP 11
.B SEMVMX
Valeur maximale pour
.BR semval
dépendant de l'implémentation (généralement 32767).
.LP
Pour améliorer la portabilité, il vaut mieux invoquer toujours
.B semctl
avec quatre arguments.
Sous Linux, la fonction
.B semctl
n'est pas un véritable appel-système, mais est implémentée au moyen de
l'appel-système commun
.BR ipc (2).
.SH CONFORMITÉ
SVr4, SVID.  SVr4 documente des conditions d'erreurs supplémentaires
EINVAL et EOVERFLOW.
.SH "VOIR AUSSI"
.BR ipc (2),
.BR semget (2),
.BR semop (2),
.BR ipc (5)
.SH TRADUCTION
Christophe Blaess, 1996-2003.
