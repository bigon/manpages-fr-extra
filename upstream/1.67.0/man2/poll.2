.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (C) 1997 Andries Brouwer (aeb@cwi.nl)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 21/07/1997 par Christophe Blaess (ccb@club-internet.fr)
.\" màj 10/12/1997 (LDP man-pages 1.18)
.\" màj 18/07/2003 (LDP man-pages 1.56)
.\" MàJ 25/07/2003 LDP-1.57
.\" MàJ 30/07/2003 LDP-1.58
.TH POLL 2 "30 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
poll \- Attendre un événement concernant un descripteur de fichier.
.SH SYNOPSIS
.B #include <linux/asm/poll.h>
.sp
.BI "int poll(struct pollfd *" ufds ", unsigned int " nfds ", int " délai );
.SH DESCRIPTION
.B poll
est une variation sur le thème de
.BR select (2).
Il utilise une table de
.I nfds
structures du type
.br
.nf
        struct pollfd {
                int fd;         /* Descripteur de fichier */
                short events;   /* Événements attendus	  */
                short revents;  /* Événements détectés    */
        };
.fi
et un
.I délai
en millisecondes. Une valeur négative indique un délai infini.
Le champ
.I fd
contient un descripteur de fichier ouvert.
Le champ
.I events
est un paramètre d'entrée, un masque de bits indiquant les événements
qui intéressent l'application.
Le champ
.I revents
est un paramètre de sortie, rempli par le noyau avec les événements qui
se sont effectivement produits, du type demandé, ou de l'une des valeurs
.BR POLLERR ,
.BR POLLHUP
ou
.BR POLLNVAL .
(Ces trois bits n'ont pas de signification dans la demande
.IR events ,
et se trouvent positionnés dans la valeur de retour
.I revents
si l'une des conditions correspondantes se produit).

Si aucun événement attendu (ni aucune erreur) ne s'est déjà produit, le noyau
attend leur occurrence pendant
.I timeout
millisecondes.
Les bits possibles pour ces masques sont définis dans <sys/poll.h>\ :
.br
.nf
    #define POLLIN    0x0001  /* Données disponibles en lecture  */
    #define POLLPRI   0x0002  /* Données urgentes disponibles    */
    #define POLLOUT   0x0004  /* Une écriture ne bloquera pas    */
    #define POLLERR   0x0008  /* Condition d'erreur              */
    #define POLLHUP   0x0010  /* Déconnexion                     */
    #define POLLNVAL  0x0020  /* Requête invalide, fd pas ouvert */
.fi
Pour un fichier source XPG4.2, on a aussi\ :
.br
.nf
#ifdef _XOPEN_SOURCE
    #define POLLRDNORM 0x0040 /* Données normales prêtes à lire */
    #define POLLRDBAND 0x0080 /* Données prioritaires à lire    */
    #define POLLWRNORM 0x0100 /* Écriture normale possible      */
    #define POLLWRBAND 0x0200 /* Écriture prioritaire possible  */
#endif
.fi
De plus, Linux connait une constante
.br
.nf
#ifdef _GNU_SOURCE
    #define POLLMSG   0x0400
#endif
.fi
.SH "VALEUR RENVOYÉE"
S'il réussit,
.B poll
renvoie une valeur positive représentant le nombre de structures
ayant un champ
.I revents
non-nul. C'est à dire le nombre de structures pour lesquels un événement
attendu, ou une erreur, s'est produit.
Une valeur de retour nulle indique un dépassement du délai d'attente.
S'il échoue,
.B poll
renvoie \-1, et 
.I errno
contient le code d'erreur.
.SH ERREURS
.TP
.B EBADF
Un descripteur de fichier invalide est présent dans un ensemble.
.TP
.B ENOMEM
Pas assez de mémoire pour allouer la table des descripteurs de fichiers.
.TP
.B EFAULT
La table fournie en argument n'est pas dans l'espace d'adressage du processus
appelant.
.TP
.B EINTR
Un signal a été reçu avant qu'un événement intéressant ne se produise.
.SH "CONFORMITÉ"
XPG4-UNIX
.SH NOTES
L'appel système \fBpoll\fP() a été introduit dans la version 2.1.23
du noyau Linux. La fonction de bibliothèque \fBpoll\fP() est apparue
dans la version 5.4.28 de la libc, et fournit une émulation basée sur
l'appel système \fBselect\fP() si le noyau n'a pas d'appel système \fBpoll\fP().
.SH "VOIR AUSSI"
.BR select (2)
.BR select_tut (2)
.SH TRADUCTION
Christophe Blaess, 1996-2003.
