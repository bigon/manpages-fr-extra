.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" Mise a Jour 8/04/97
.\" Mise a Jour 18/07/2003 LDP-1.56
.TH MSGGET 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
msgget \- Obtenir un identificateur de file de messages.
.SH SYNOPSIS
.nf
.B
#include <sys/types.h>
.B
#include <sys/ipc.h>
.B
#include <sys/msg.h>
.fi
.sp
.BI "int msgget ( key_t " key ,
.BI "int "msgflg " );
.SH DESCRIPTION
Cette fonction renvoie l'identificateur de la file de
messages associée à la clé
.I key.
Une nouvelle file de messages est créée si
.I key
a la valeur
.B IPC_PRIVATE
ou si
aucune file de message n'est associée à
.IR key ,
et si la valeur
.B IPC_CREAT
a été introduite dans
.I msgflg
(c'est à dire
.IB msgflg & IPC_CREAT
non nul).
La présence des champs
.B IPC_CREAT
et
.B IPC_EXCL
dans
.I msgflg
joue le même rôle, par rapport à l'existence de
la file de messages, que la présence des champs
.B O_CREAT
et
.B O_EXCL
dans l'argument
.I mode
de l'appel système
.BR open "(2) :"
La fonction
.B msgget
échouera si
.I msgflg
indique à la fois
.B IPC_CREAT
et
.B IPC_EXCL
et si une file de messages existe déjà associée à
.IR key.
.PP
Lors de la création, les 9 bits de poids faibles de l'argument
.I msgflg
définissent les permissions d'accès à la file de message
(pour le propriétaire, le groupe, et les autres) avec le
même format et la même signification que les permissions
d'accès dans les appels
.BR open (2)
ou
.BR creat (2)
(bien que la permission d'exécution ne soit pas utilisée).
.PP
Pendant la création, l'appel système initialise la structure
système 
.B msqid_ds
de la file de messages comme suit :
.IP
.B msg_perm.cuid
et
.B msg_perm.uid
sont remplis avec l'UID effectif du processus appelant.
.IP
.B msg_perm.cgid
et
.B msg_perm.gid
sont remplis avec le GID effectif du processus appelant.
.IP
Les 9 bits de poids faibles de
.IR msgflg
sont copiés dans les 9 bits de poids faibles de
.BR msg_perm.mode .
.IP
.BR msg_qnum ,
.BR msg_lspid ,
.BR msg_lrpid ,
.BR msg_stime
et
.B msg_rtime
sont fixés à 0.
.IP
.B msg_ctime
est rempli avec l'heure actuelle.
.IP
.B msg_qbytes
est rempli avec la limite système
.BR MSGMNB .
.PP
Si la file de message existe déjà, les permissions d'accès sont
contrôlées, et une vérification est faite pour voir si la file
est prête à être détruite.
.SH "VALEUR RENVOYÉE"
.BR msgget
renvoie l'identificateur de la file de messages (un entier positif), 
s'il réussit.
En cas d'échec \-1 est renvoyé et
.B errno
contient le code d'erreur.
.SH ERREURS
.TP 11
.B EACCES
Une file de messages existe associée à la clé
.IR key ,
mais le processus appelant n'a pas de permissions sur cette
file.
.TP
.B EEXIST
Une file de messages existe associée à la clé
.B key
et
.I msgflg
réclame à la fois
.B IPC_CREAT
et
.BR IPC_EXCL .
.TP
.B ENOENT
Aucune file de messages n'existe associée à la clé
.I key
et
.I msgflg
ne contient pas
.BR IPC_CREAT .
.TP
.B ENOMEM
Pas assez de mémoire pour les nouvelles structures de données.
.TP
.B ENOSPC
Le nombre maximum de files de messages sur le système
.RB ( MSGMNI )
est atteint.
.SH NOTES
.B IPC_PRIVATE
n'est pas destiné au champ
.I msgflg
mais est du type
.B key_t.
Si cette valeur spéciale est fournie à la place de
.IR key ,
l'appel système ignorera tout sauf les 9 bits de poids faibles de
.I msgflg
et créera une nouvelle file de messages.
.PP
La limite système concernant les files de messages et affectant
.B msgget
est
.TP 11
.B MSGMNI
Nombre maximum de files de messages sur le système.
.SH BOGUES
L'utilisation de
.B IPC_PRIVATE
n'empêche pas les autres processus d'avoir accès à la file
de messages allouée. Le nom IPC_PRIVATE a été mal choisi, ICP_NEW aurait été mieux.
.PP
.SH CONFORMITÉ
SVr4, SVID.  SVr4 ne documente pas le code d'erreur EIDRM.
Jusqu'à la version 2.3.20, Linux renvoyait EIDRM pour un
.B msgget
sur une file de messages prête à être supprimée.
.SH "VOIR AUSSI"
.BR ftok (3),
.BR ipc (5),
.BR msgctl (2),
.BR msgsnd (2),
.BR msgrcv (2) 
.SH TRADUCTION
Christophe Blaess, 1996-2003.
