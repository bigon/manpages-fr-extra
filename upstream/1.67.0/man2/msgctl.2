.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" Mise a Jour 8/04/97
.\" Mise a Jour 30/05/2001 LDP-man-page-1.36
.\" Mise a Jour 18/07/2003 LDP-man-page-1.56
.TH MSGCTL 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
msgctl \- Contrôler les messages.
.SH SYNOPSIS
.nf
.B
#include <sys/types.h>
.B
#include <sys/ipc.h>
.B
#include <sys/msg.h>
.fi
.sp
.BI "int msgctl ( int " msqid ,
.BI "int  " cmd ,
.BI "struct msqid_ds *" buf  );
.SH DESCRIPTION
Cette fonction permet d'effectuer l'opération 
indiquée par
.I cmd
sur la file de messages ayant l'identificateur
.IR msqid.
Les valeurs possibles de
.I cmd
sont\ :
.TP
.B IPC_STAT
Copier les informations depuis la structure représentant
la file de messages dans la structure pointée par
.IR buf .
L'appelant doit avoir des privilèges d'accès en lecture sur
la file de messages.
.TP
.B IPC_SET
Écrire la valeurs de certains champs de la structure
.B msqid_ds
pointée par
.I buf
dans la structure représentant la file de messages, 
en mettant à jour le champ
.BR msg_ctime .
Les champs suivant de la structure peuvent être mis à jour\ :
.nf
.sp
.ft B
	msg_perm.uid
	msg_perm.gid
	msg_perm.mode \fR/* 9 bits poids faibles */\fP
	msg_qbytes
.fi
.ft R
.sp
L'UID effectif du processus appelant doit être soit 
celui du Super\-User
soit celui du créateur ou du propriétaire 
de la file de messages.
Seul le Super\-User peut augmenter la valeur de
.B msg_qbytes
au\-dessus de la constante système
.BR MSGMNB.
.TP
.B IPC_RMID
Effacer immédiatement la file de messages et ses structures
de données, en réveillant tous les processus écrivains et
lecteurs en attente. Ils obtiendront un code d'erreur, et
.B errno
aura la valeur
.BR EIDRM.
L'UID effectif du processus appelant doit être soit celui 
du Super\-User
soit celui du créateur ou du propriétaire de la file de messages.
.SH "VALEUR RENVOYÉE"
.BR msgctl
renvoie 0 s'il réussit, ou \-1 s'il échoue, auquel
cas
.B errno
contient le code d'erreur.
.SH ERREURS
.TP
.B EACCES
L'argument
.I cmd
réclame l'opération
.B IPC_STAT
mais le processus appelant n'a pas d'accès en lecture sur la
file de messages
.IR msqid.
.TP
.B EFAULT
L'argument
.I cmd
réclame l'opération
.B IPC_SET
ou
.B IPC_STAT
mais
.I buf
pointe en dehors de l'espace d'adressage accessible.
.TP
.B EIDRM
La file de messages a déjà été supprimée.
.TP
.B EINVAL
.I cmd
ou
.IR msqid 
ont une valeur illégale.
.TP
.B EPERM
L'argument
.I cmd
réclame l'opération
.B IPC_SET
ou
.B IPC_RMID
mais l'UID effectif du processus appelant n'a pas
assez de privilèges pour réaliser la commande.
C'est aussi le cas d'un processus non Super\-User
tentant d'augmenter
.B msg_qbytes
au-dessus de la valeur
.BR MSGMNB .
.SH NOTES
Les appels
.BR IPC_INFO ,
.BR MSG_STAT
et
.B MSG_INFO
sont utilisés par le programme
.BR ipcs (8)
pour fournir des informations sur les ressources allouées
dans le futur, ceci peut être modifié si besoin, ou remplacé par
une interface avec le système de fichiers proc.
.LP
Divers champs de la structure \fIstruct msqid_ds\fP étaient des shorts sous
Linux 2.2 et sont devenus longs sous Linux 2.4. Pour en profiter, une
recompilation avec la GlibC 2.1.91 ou ultérieure devrait suffire.
(Le noyau distingue les appels anciens et nouveaux par un drapeau IPC_64 dans
.IR cmd ).
.SH "CONFORMITÉ"
SVr4, SVID. SVID ne documente pas la condition d'erreur EIDRM.
.SH "VOIR AUSSI"
.BR ipc (5),
.BR msgget (2),
.BR msgsnd (2),
.BR msgrcv (2).
.SH TRADUCTION
Christophe Blaess, 1996-2003.
