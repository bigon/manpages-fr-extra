.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 15/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" Mise a Jour 8/04/97
.\" Mise a jour 18/05/99 - LDP-man-pages-1.23
.\" Mise a jour 18/07/03 - LDP-man-pages-1.56
.TH SEMGET 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
semget \- Obtenir l'identificateur d'un ensemble de sémaphores.
.SH SYNOPSIS
.nf
.B #include <sys/types.h>
.B #include <sys/ipc.h>
.B #include <sys/sem.h>
.fi
.sp
.BI "int semget (key_t " key ,
.BI "int " nsems ,
.BI "int " semflg  );
.SH DESCRIPTION
Cette fonction retourne l'identificateur de l'ensemble de 
sémaphores associé à la valeur de clé
.IR key .
Un nouvel ensemble contenant
.I nsems
sémaphores est créé si 
.I key
a la valeur
.B IPC_PRIVATE
ou si aucun ensemble n'est associé à
.IR key ,
et si l'option
.B IPC_CREAT
est présente dans
.I semflg.
(i.e.
.IR semflg " &"
.B IPC_CREAT
différent de zéro).
.PP
La présence de
.B IPC_CREAT
et
.B IPC_EXCL
dans le champ
.I semflg
joue le même rôle, par rapport à l'existence du
jeu de sémaphores, que la présence de
.B O_CREAT
et
.B O_EXCL
dans l'argument de mode de l'appel système
.BR open (2)
i.e. la fonction
.B semget
échouera si
.I semflg
demande à la fois
.B IPC_CREAT
et
.B IPC_EXCL
et si un sémaphore associé a
.I key 
existe déjà.
.PP
Pendant la création, les 9 bits de poids faibles de
l'argument
.I semflg
définissent les permissions d'accès (pour le propriétaire,
le groupe et les autres) au jeu de sémaphores, en utilisant
le même format et la même signification  que les droits
d'accès dans
.BR open (2)
ou
.BR creat (2).
Les permissions d'exécutions ne sont pas utilisées par le système, et
pour un jeu de sémaphores, l'autorisation d'écriture signifie
autorisation de modification.
.PP
Durant la création, la structure de données
.B semid_ds
contrôlant le jeu de sémaphores est initialisée ainsi :
.IP
.B sem_perm.cuid
et
.B sem_perm.uid
contiennent l'UID effectif du processus appelant.
.IP
.B sem_perm.cgid
et
.B sem_perm.gid
contiennent le GID effectif du processus appelant.
.IP
le 9 bits de poids faibles de
.B sem_perm.mode
sont remplis avec les 9 bits de poids faibles de
.IR semflg .
.IP
.B sem_nsems
reçoit la valeur
.IR nsems .
.IP
.B sem_otime
est mis a 0.
.IP
.B sem_ctime
est rempli avec l'heure actuelle.
.PP
l'argument
.I nsems
peut valoir
.B 0
(ignore)
si l'appel système n'est pas une création d'ensemble de sémaphores.
Autrement
.I nsems
doit être supérieur à
.B 0
et inférieur ou égal au nombre maximal de sémaphores par ensemble,
.RB ( SEMMSL ).
.PP
Si le jeu de sémaphores existe déjà, les permissions d'accès sont
contrôlées, et l'on vérifie si l'ensemble est sur le point
d'être détruit.
.SH "VALEUR RENVOYÉE"
Si l'appel réussit, il renvoie l'identificateur de l'ensemble (un
entier positif), sinon il renvoie
.B \-1
et
.B errno
contient le code d'erreur.
.SH ERREURS
.TP 11
.B Eaccès
Le jeu de sémaphore associé à
.IR key 
existe, mais le processus n'a aucun droit d'accès sur lui
.TP
.B EEXIST
Le jeu de sémaphore associé a
.B key
existe mais l'argument
.I semflg
précise à la fois
.B IPC_CREAT
et
.BR IPC_EXCL .
.\" .TP
.\" .B EIDRM
.\" le jeu de sémaphores est prêt à être détruit
.TP
.B ENOENT
Aucun jeu de sémaphore associé a
.I key
n'existe
et l'argument
.I semflg
ne précise pas
.BR IPC_CREAT .
.TP
.B EINVAL
.IR nsems
est inférieur à zéro ou supérieur à la limite sur le nombre de sémaphores
par ensemble,
.RB ( SEMMSL ),
ou l'ensemble de sémaphores identifié par
.I key
existe déjà, et
.I nsems
est plus grand que le nombre de sémaphores par ensemble..
.TP
.B ENOMEM
Pas assez de mémoire pour créer les structures nécessaires.
.TP
.B ENOSPC
Le nombre maximal de jeux de sémaphores sur le système
.RB ( SEMMNI )
est atteint,
ou le nombre maximal de sémaphores sur le système est atteint
.RB ( SEMMNS ).
.SH NOTES
.B IPC_PRIVATE
n'est pas une option, mais un objet de type
.BR key_t .
Si l'on utilise cette valeur spéciale dans l'argument
.IR key ,
l'appel système ne se préoccupera que des 9 bits de poids
faibles de
.I semflg
et tentera de créer un nouveau jeu de sémaphores.
.PP
Les limites suivantes concernent l'appel système
.B semget :
.TP 11
.B SEMMNI
Nombre maximal d'ensembles de sémaphores sur le système.
.TP
.B SEMMSL
Nombre maximal de sémaphores par ensemble.
.TP
.B SEMMNS
Nombre maximal de sémaphores sur le système\ : dépend de l'implémentation.
Les valeurs supérieures à
.B SEMMSL * SEMMNI
sont incorrectes.
.SH BOGUES
L'utilisation de 
.B IPC_PRIVATE
n'empêche pas les autres processus d'accéder au jeu de sémaphores alloué.
Le choix de ce mot est malheureux, il aurait mieux valu utiliser IPC_NEW.
.PP
Les structures de données associées a chaque sémaphore dans l'ensemble
ne sont pas initialisées lors de l'appel système.
Pour effectuer cette initialisation, il faut exécuter un appel à
.BR semctl (2)
avec les commandes
.B SETVAL
ou
.B SETALL.
.SH CONFORMITÉ
SVr4, SVID.  SVr4 documente des conditions d'erreur supplémentaires
EFBIG, E2BIG, EAGAIN, ERANGE, et EFAULT.
.SH "VOIR AUSSI"
.BR ftok (3),
.BR ipc (5),
.BR semctl (2),
.BR semop (2).
.SH TRADUCTION
Christophe Blaess, 1996-2003.
