.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" 1995-11-26  Markus Kuhn <mskuhn@cip.informatik.uni-erlangen.de>
.\"      First version written
.\"
.\" Traduction  11/10/1996 Christophe BLAESS (ccb@club-internet.fr)
.\" Màj 08/04/1997
.\" Màj 30/05/2001 LDP-1.36
.\" Màj 18/07/2003 LDP-1.56
.\" Màj 27/06/2005 LDP-1.60
.\"
.TH MLOCKALL 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
mlockall \- Désactiver la pagination pour le processus appelant.
.SH SYNOPSIS
.nf
.B #include <sys/mman.h>
.sp
\fBint mlockall(int \fIflags\fB);
.fi
.SH DESCRIPTION
.B mlockall
désactive la pagination pour toutes les pages présentes dans l'espace d'adressage
du processus appelant. Ceci inclut les pages de code, de données, et la pile,
tout autant que les bibliothèques partagées, les données utilisateur dans le
noyau, la mémoire partagée et les fichiers projetés en mémoire. Quand l'appel
.B mlockall
réussit, on a l'assurance que toutes les pages concernées résident en mémoire
vive (RAM) et y resteront jusqu'à un déverrouillage par la fonction
.B munlock
ou
.B munlockall
ou encore jusqu'à ce que le processus se termine ou démarre
un programme avec
.BR exec .
Les processus fils n'héritent pas du verrouillage des pages
à travers un
.BR fork .

Il y a deux domaines principaux d'applications au verrouillage de pages\ :
les algorithmes en temps réel, et le traitement de données confidentielles.
Les applications temps réel réclament un comportement temporel
déterministe, et la pagination est, avec l'ordonnancement, une
cause majeure de délais imprévus.
Ces algorithmes basculent habituellement sur un ordonnancement temps réel avec
.BR sched_setscheduler.
Les logiciels de cryptographie manipulent souvent quelques
octets hautement confidentiels, comme des mots de passe ou
des clés privées. À cause de la pagination, ces données secrètes
risquent d'être transférées sur un support physique où elles
pourraient être lues par un ennemi longtemps après que le
logiciel se soit terminé.
Néanmoins, pour les applications sécurisées, seule une petite
partie de la mémoire doit être verrouillée, pour laquelle la
fonction
.B mlock
est parfaitement appropriée.

Le paramètre
.I flags
est constitué par un
.I OU binaire
( | ) entre les constantes symboliques suivantes\ :
.TP 1.2i
.B MCL_CURRENT
Verrouiller toutes les pages correspondant actuellement à l'espace
d'adressage du processus.
.TP
.B MCL_FUTUR
Verrouiller toutes les pages qui seront dans l'espace d'adressage
du processus dans le futur. Ceci concerne par exemple les nouvelles
pages réclamées par un agrandissement de la pile ou du tas, autant
que les nouveaux fichiers projetés en mémoire, ou les nouvelles
régions de mémoire partagée.
.PP
Si
.B MCL_FUTUR
a été réclamé, et que le nombre de pages verrouillées
excède la limite maximale, l'appel système ayant entraîné le
dépassement échouera avec une erreur
.BR ENOMEM.
Si le problème se pose à cause de l'expansion de la pile, le noyau
empêchera l'agrandissement de celle-ci et déclenchera un signal
.BR SIGSEGV.

Les processus temps\-réel doivent réserver suffisamment de pages
avant d'entrer dans des portions critiques, pour éviter tout
déclenchement de faute de page.
Ceci peut être effectué simplement en appelant une fonction
réclamant une variable automatique suffisamment grande, et qui
écrit dans cette variable de manière à allouer ces pages pour
la pile.
L'écriture dans la variable garantit qu'il ne se produira même pas
de faute de page de copie\-sur\-écriture durant l'exécution de la
section critique.

Il n'y a pas d'empilement des verrouillages mémoire, ce qui
signifie qu'une page verrouillée plusieurs fois par
.B mlock
ou
.B mlockall
sera libérée en un seul appel à
.B munlock
pour la zone mémoire correspondante ou par un appel à
.BR munlockall.
Les pages qui sont verrouillées par plusieurs zones, ou
par plusieurs processus restent en mémoire vive tant qu'il
y a au moins un processus ou une zone qui les verrouille.
.SH "VALEUR RENVOYÉE"
.B mlockall
renvoie 0 s'il réussit, ou \-1 s'il échoue, auquel cas
.I errno
contient le code d'erreur.
.SH ERREURS
.TP
.B ENOMEM
Le processus a dépassé le nombre maximal de pages verrouillées.
.TP
.B EPERM
L'appelant n'a pas les privilèges appropriés, seul le Super\-User
peut verrouiller des pages.
.TP
.B EINVAL
Un attribut inconnu a été spécifié.
.SH DISPONIBILITÉ
Sur les systèmes POSIX où
.B mlockall
et
.B munlockall
sont disponibles, la constante symbolique
.B _POSIX_MEMLOCK
est définie dans <unistd.h> comme étant une valeur supérieure à 0. (Voir aussi
.BR sysconf (3).)
.\" POSIX 1003.1-2001: devrait être définie à -1, 0 ou 200112L.
.\" -1: indisponible, 0: demander en utilisant sysconf().
.\" glibc les définit à 1.
.SH CONFORMITÉ
POSIX.1b, SVr4. SVr4 documente un code d'erreur EAGAIN supplémentaire.
.SH "VOIR AUSSI"
.BR munlockall (2) ,
.BR mlock (2) ,
.BR munlock (2) ,
.BR sysconf (3)

.SH TRADUCTION
Christophe Blaess, 1996-2003.
