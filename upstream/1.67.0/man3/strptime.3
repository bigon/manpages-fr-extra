.\" Copyright 1993 Mitchum DSouza <m.dsouza@mrc-apu.cam.ac.uk>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\"
.\" Traduction 10/11/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" màj 11/07/2000 LDP 1.30
.\"
.\" Mise à jour 06/06/2001 - LDP-man-pages-1.36
.\" Mise à jour 26/01/2002 - LDP-man-pages-1.47
.\" MàJ 21/07/2003 LDP-1.56
.TH STRPTIME 3 "21 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
strptime \- Conversion d'une chaîne de date en une structure tm.
.SH SYNOPSIS
.BR "#define _XOPEN_SOURCE" " /* Pour GlibC2 */"
.br
.B #include <time.h>
.sp
.BI "char *strptime (char *" buf ", const char *" format ,
.BI "const struct tm *" tm );

.SH DESCRIPTION
La fonction
.B strptime()
est complémentaire de la fonction
.BR strftime() .
Elle convertit la chaîne de caractères pointée par
.I buf
en une valeur qui est stockée dans la structure
.B tm
pointée par l'argument
.IR tm ,
la conversion étant réalisée en suivant les indications contenues dans
la chaîne
.IR format .
Cette dernière contient des descripteurs de champs et du texte, rappelant
.BR scanf (3).
Chaque descripteur consiste en un caractère
.B %
suivi d'un second caractère indiquant le champ à interpréter.
Tous les autres sont considérés comme du texte. Toutefois un espace blanc se trouvant
dans la chaîne de format peut être mis en correspondance avec zéro ou plusieurs espaces.
Il devrait toujours y avoir un espace ou un autre caractère alphanumérique entre
deux descripteurs de champs.
.PP
La fonction
.BR strptime ()
traite la chaîne d'entrée de gauche à droite. Les trois types d'éléments d'entrée
possibles (espace, caractère littéral, conversion) sont manipulés l'un après l'autre. Si l'entrée ne peut pas être mise en correspondance avec la chaîne de format,
la fonction s'arrête. Le reste du format et de la chaîne d'entrée ne sont pas
traités.
.PP
Les descripteurs applicables sont décrits ci-dessous. Dans le cas d'une
chaîne de caractères (comme un nom de jour ou de mois), la comparaison
ne tient pas compte des majuscules/minuscules. Dans le cas d'un nombre, les
zéros au début sont autorisés mais pas obligatoires.
.TP
.B %%
Le caractère
.B %
.TP
.BR %a " ou " %A
Le jour de la semaine en utilisant les noms correspondants à la localisation.
Les noms abrégés ou entiers peuvent être utilisés.
.TP
.BR %b " ou " %B " ou " %h
Le mois en utilisant les noms correspondants à la localisation.
Les noms abrégés ou entiers peuvent être utilisés.
.TP
.B %c
La date et l'heure en utilisant le format de la localisation.
.TP
.B %C
Le numéro de siècle (0-99).
.TP
.BR %d " ou " %e
Le jour du mois (1-31)
.TP
.B %D
La date, ainsi : %m/%d/%y. C'est la date au format américain, très gênante pour
les autres pays, notamment l'Europe qui utilise une notation %d/%m%y. Le format
standard ISO 8601 est %Y-%m-%d.
.TP
.B %H
L'heure (0-23)
.TP
.BR %I
L'heure (0-12)
.TP
.B %j
Le numéro du jour dans l'année (001-366)
.TP
.B %m
Le numéro du mois (1-12)
.TP
.B %M
La minute (0-59)
.TP
.B %n
Un espace blanc quelconque
.TP
.B %p
Équivalent local de AM ou PM (éventuellement rien).
.TP
.B %r
L'heure sur 12 heures avec l'équivalent local de AM ou PM. Dans la
localisation POSIX, équivalent à %I:%M:%S %p. Si le champ \fIt_fmt_ampm\fP de
la catégorie LC_TIME de la localisation est vide, le comportement est indéfini.
.TP
.B %R
L'heure, ainsi : %H:%M
.TP
.B %S
Les secondes (0-61, des secondes de rattrapages sont autorisées)
.TP
.B %t
Un espace blanc quelconque
.TP
.B %T
Équivalent de %H:%M:%S
.TP
.B %U
Le numéro de semaine (0-53), le premier dimanche de janvier étant le premier
jour de la semaine 1.
.TP
.B %w
Le numéro du jour dans la semaine (0-6), en commençant le dimanche.
.TP
.B %W
Le numéro de semaine (0-53), le premier lundi de janvier étant le premier
jour de la semaine 1.
.TP
.B %x
la date, en utilisant le format usuel de la localisation.
.TP
.B %X
l'heure, en utilisant le format usuel de la localisation.
.TP
.B %y
l'année sans le siècle (0-99; les zéros au début sont autorisés mais pas obligatoires). Lorsque le siècle n'est pas indiqué par une autre conversion, les années
69 à 99 sont considérées comme étant du vingtième siècle (1969 à 1999), et les
années 00-68 du vingt-et-unième siècle (2000-2068).
.TP
.B %Y
L'année en incluant le siècle (par exemple, 1996)
.LP
Pour les noms des mois ou des jours de la semaine, les différences entre
majuscules et minuscules sont ignorées.
.LP
Certains descripteurs peuvent être complétés par les caractères modificateurs
E et O, indiquant qu'il faut employer un autre format ou une autre spécification.
Si cet autre format, ou cette autre conversion n'est pas disponible dans la
localisation en cours, le descripteur n'est pas modifié.
.LP
Le modificateur E indique que la chaîne d'entrée peut contenir des versions
différentes de la date et l'heure, en fonction de la localisation :
.TP
.B %Ec
Une représentation différente de la date et l'heure.
.TP
.B %EC
Le nom de l'année de base (période) dans la représentation locale
alternative.
.TP
.B %Ex
Une autre représentation de la date.
.TP
.B %EX
Une autre représentation de l'heure.
.TP
.B %Ey
Le décalage (en année) par rapport à l'année %EC dans la représentation
locale alternative.
.TP
.B %EY
La représentation complète de l'année.
.LP
Le modificateur O indique que les saisies numériques peuvent être effectuées
dans un format différent, dépendant de la localisation.
.TP
.BR %Od " or " %Oe
Le jour du mois. Les zéros en tête sont permis mais pas obligatoires.
.TP
.B %OH
L'heure (sur 24 heures).
.TP
.B %OI
L'heure (sur 12 heures).
.TP
.B %Om
Le numéro du mois.
.TP
.B %OM
Les minutes.
.TP
.B %OS
Les secondes.
.TP
.B %OU
Le numéro de la semaine.
.TP
.B %Ow
Numéro du jour dans la semaine, le dimanche étant zéro.
.TP
.B %OW
Le numéro du jour de la semaine, en commençant le lundi.
.TP
.B %Oy
L'année (ou décalage par rapport à %C).
.LP
Les champs de la structure \fItm\fP définie dans \fI<time.h>\fP sont :
.sp
.RS
.nf
.ne 12
.ta 8n 16n 32n
struct tm
{
  int  tm_sec;   /* secondes           */
  int  tm_min;   /* minutes            */
  int  tm_hour;  /* heures             */
  int  tm_mday;  /* jour du mois       */
  int  tm_mon;   /* mois               */
  int  tm_year;  /* année              */
  int  tm_wday;  /* jour de la semaine */
  int  tm_yday;  /* jour de l'année    */
  int  tm_isdst; /* décalage été/hiver */
};
.ta
.fi
.RE
.SH "VALEUR RENVOYÉE"
La fonction \fBstrptime()\fP renvoie un pointeur sur le premier caractère
de la chaîne
.I buf
n'ayant pas été traité. Dans le cas où la chaîne de saisie est plus longue que
ce que réclame le format, la valeur renvoyée pointe juste après le dernier
caractère d'entrée ayant été analysé. Si toute la chaîne a été traitée,
le pointeur est dirigé sur le caractère NUL en fin de chaîne.
Si
.BR strptime ()
n'arrive pas à effectuer toutes les conversions, il renvoie \fBNULL\fP.
.SH CONFORMITÉ
XPG4, SUSv2, POSIX 1003.1-2001.
.SH EXEMPLE
L'exemple suivant montre l'utilisation de \fBstrptime()\fP
et \fBstrftime()\fP.
.sp
.nf
.ne 12
.ta 8n 16n
#include <stdio.h>
#include <time.h>
 
int main()
{
  struct tm tm;
  char buf[255];
 
  strptime("2001-11-12 18:31:01", "%Y-%m-%d %H:%M:%S", &tm);
  strftime(buf, sizeof(buf), "%d %b %Y %H:%M", &tm);
  puts(buf);
  return 0;
}
.ta
.fi
.SH "EXTENSIONS GNU"
Pour des raisons de symétrie, la GlibC essaye d'offrie pour
.B strptime
les mêmes caractères de formatage que ceux de
.BR strftime.
(Dans la plupart des cas, les champs sont lus mais aucun membre de \fItm\fP
n'est modifié).
Ceci conduit à\ :
.TP
.B %F
Équivalent à \fB%Y-%m-%d\fP, le format ISO 8601 pour la date.
.TP
.B %g
L'année correspondant au numéro de semaine ISO, sans le siècle (0-99).
.TP
.B %G
L'année correspondant au numéro de semaine ISO (par exemple 1991).
.TP
.B %u
Le numéro du jour de la semaine (1-7, lundi valant 1).
.TP
.B %V
Le numéro de semaine ISO 8601:1988 (1-53). Si la semaine (commençant lundi)
contenant le 1er janvier a quatre jours ou plus de la nouvelle année, elle
est comptée en semaine 1. Sinon elle est considérée comme dernière semaine
de l'année précédente, et c'est la suivante qui est la semaine 1.
.TP
.B %z
Spécification standard RFC-822/ISO 8601 pour le fuseau horaire.
.TP
.B %Z
Le nom du fuseau horaire.
.LP
De même, à cause des extensions GNU de \fIstrftime\fP,
%k est accepté en synonyme de %H, et %l est accepté comme
synonyme de %I, et %P en synonyme de %p.
Enfin,
.TP
.B %s
Le nombre de secondes depuis le 1er janvier 1970 à Oh TU. Les secondes de
rattrapage ne sont pas comptées sauf si un support spécifique est disponible.
.LP
L'implémentation de la GlibC n'impose pas la présence de caractères blancs
entre deux descripteurs de champs.
.SH NOTES
En principe cette fonction n'initialise pas \fBtm\fP, mais n'y stocke que
les valeurs lues. Ceci signifie que le contenu de \fBtm\fP doit être initialisé
avant l'appel. Les détails diffèrent suivant les systèmes Unix. L'implémentation
de la bibliothèque C Gnu ne modifie pas les champs non mentionnés explicitement,
sauf
.IR tm_wday ,
et
.IR tm_yday
qui sont recalculés si un champ d'année, de mois ou de jour est modifié.
.PP
Cette fonction n'est disponible que dans les versions de bibliothèque
depuis la 4.6.8. Les bibliothèques Linux libc4 et libc5 incluaient
toujours le prototype de cette fonction, la bibliothèque GlibC 2 ne fournit
le prototype que si les constantes _XOPEN_SOURCE ou _GNU_SOURCE sont définies.
.PP
Les caractères de modification locale E et O sont acceptés depuis la bibliothèque
5.4.13. La conversion 'y' est toujours considérée comme appartenant au
vingtième siècle dans les libc4 et libc5. Elle est prise dans l'intervalle
1950-2049 par la GlibC 2.0, et 1969-2068 par la GlibC 2.1.
.SH "VOIR AUSSI"
.BR time (2),
.BR scanf (3),
.BR setlocale (3),
.BR strftime (3)
.SH TRADUCTION
Christophe Blaess, 1996-2003.
