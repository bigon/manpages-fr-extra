.\" This man page is Copyright (C) 1998 Alan Cox.
.\" Permission is granted to distribute possibly modified copies
.\" of this page provided the header is included verbatim,
.\" and in case of nontrivial modification author and date
.\" of the modification is added to the header.
.\" $Id: ddp.7,v 1.3 1999/05/13 11:33:22 freitag Exp $
.\" Traduction 04/01/2000 par Christophe Blaess (ccb@club-internet.fr)
.\" LDP-man_pages 1.28
.\" MàJ 25/07/2003 LDP-1.56
.TH DDP 7 "25 juillet 2003" LDP "Manuel de l'administrateur Linux"
.SH NOM
ddp \- Implémentation Linux du protocole AppleTalk.
.SH SYNOPSIS
.B #include <sys/socket.h>
.br
.B #include <netatalk/at.h> 
.sp
.IB ddp_socket " = socket(PF_APPLETALK, SOCK_DGRAM, 0);"
.br 
.IB raw_socket " = socket(PF_APPLETALK, SOCK_RAW, " protocole ");"
.SH DESCRIPTION 
Linux implémente le protocole AppleTalk décrit dans le document
.IR "Inside Appletalk" .
Seuls le niveau DDP et l'AARP sont présents dans le noyau, ils sont
conçus pour être utilisés via les bibliothèques du protocole
.BR netatalk .
Cette page documente
l'interface pour ceux qui ont envie (ou besoin)
d'utiliser directement le niveau DDP.
.PP
La communication entre Appletalk et le programme utilisateur fonctionne
en utilisant une interface compatible avec les sockets BSD. Voir
.BR socket (7). 
.PP
Une socket AppleTalk est créée en appelant la fonction
.BR socket (2) 
avec un argument 
.B PF_APPLETALK
en famille de socket. Les types valides sont
.B SOCK_DGRAM
pour ouvrir une socket
.B ddp 
ou 
.B SOCK_RAW
pour ouvrir une socket
.BR raw . 
.I protocol
est le protocole Appletalk pour envoyer ou recevoir des données.
Pour le type
.B SOCK_RAW 
il faut indiquer
.BR ATPROTO_DDP .
.PP
Les sockets Raw peuvent seulement être ouvertes par un processus ayant UID effectif nul ou
ayant la capacité
.BR CAP_NET_RAW .
.SH "FORMAT D'ADRESSE"
Une socket AppleTalk est définie comme la combinaison d'un numéro de réseau, d'un
numéro de noeud et d'un numéro de port.
.PP
.RS
.nf
.ta 4n 20n 32n
struct at_addr {
    u_short    s_net;
    u_char     s_node;
};

struct sockaddr_atalk {
    sa_family_t     sat_family; /* Famille d'adresse */
    u_char          sat_port;   /* Port              */
    struct at_addr  sat_addr;   /* noeud / réseau    */
};
.ta
.fi
.RE 
.PP
.I sat_family
doit toujours être rempli avec
.B AF_APPLETALK. 
.I sat_port
contient le numéro de port. Les numéros inférieurs à 129 sont
réservés. Seuls les processus ayant un UID effectif nul ou
la capacité
.B CAP_NET_BIND_SERVICE 
peut appeler
.BR bind (2)
sur ces sockets.
.I sat_addr 
est l'adresse de l'hôte.
Le membre
.I net
de la structure
.B at_addr
contient le numéro de réseau dans l'ordre des octets du réseau.
La valeur
.B AT_ANYNET 
est générique et correspond aussi à
\(lqce réseau\(rq.
Le membre
.I node
de la structure
.B at_addr
contient le numéro d'hôte. La valeur
.B AT_ANYNODE 
est générique, et correspond aussi à
\(lqcet hôte\(rq. La valeur
.B ATADDR_BCAST 
est une adresse broadcast locale.
.\" XXX this doesn't make sense [johnl]
.SH "OPTIONS DES SOCKETS"
Il n'y a pas d'options spécifiques au protocole sur les sockets.
.SH SYSCTLS
Il y a une interface sysctls pour configurer certains paramètres AppleTalk globaux.

On peut y accéder en lisant ou écrivant les fichiers
.B /proc/sys/net/atalk/* 
ou en utilisant l'appel-système
.BR sysctl (2).
.TP
.B aarp-expiry-time
L'intervalle de temps (en secondes) avant qu'une entrée du cache AARP expire.
.TP
.B aarp-resolve-time
L'intervalle de temps (en secondes) avant qu'une entrée du cache AARP soit résolue.
.TP
.B aarp-retransmit-limit
Le nombre de retransmissions d'une demande AARP avant de déclarer le noeud mort.
.TP
.B aarp-tick-time
La période (en secondes) de la temporisation dirigeant l'AARP.
.PP
Les valeurs par défaut correspondent aux spécifications et ne doivent
normalement pas être modifiées.

.SH IOCTLS
Toutes les ioctls décrites dans la page
.BR socket (7) 
s'appliquent au ddp.

.\" XXX Add a chapter about multicasting

.SH NOTES
Soyez très prudents avec l'option
.BR SO_BROADCAST ,
elle n'est pas privilégiée sous Linux. Il est facile de surcharger le réseau
en écrivant sans faire attention vers des adresses broadcast.
.SH VERSIONS
Appletalk est supporté par Linux 2.0 et ultérieurs. L'interface
.B sysctl 
est nouvelle dans Linux 2.2.
.SH ERREURS
.\" XXX document all errors. We should really fix the kernels to give more uniform
.\"     error returns (ENOMEM vs ENOBUFS, EPERM vs EACCES etc.)  
.TP
.B ENOTCONN
L'opération n'est définie que sur une socket connectée et ce n'était pas le cas.
.TP
.B EINVAL
Argument invalide.
.TP
.B EMSGSIZE 
Le datagramme est plus grand que le MTU DDP.
.TP
.B EACCES
L'utilisateur a essayé d'exécuter une opération sans avoir les permissions adéquates.
Ceci inclut l'envoi vers une adresse broadcast sans avoir l'attribut correspondant,
ou la tentative d'utilisation de port réservé sans UID effectif nul et sans la
capacité
.BR CAP_NET_BIND_SERVICE . 
.TP
.B EADDRINUSE
L'adresse est déjà utilisée.
.TP
.BR ENOMEM " et " ENOBUFS
Pas assez de mémoire
.TP
.BR ENOPROTOOPT "  " EOPNOTSUPP
Option invalide.
.TP
.B EPERM
L'utilisateur n'a pas les permissions nécessaires.
.TP
.B EADDRNOTAVAIL
On a demandé une interface inexistante, ou l'adresse d'émission réclamée
n'est pas locale.
.TP
.B EAGAIN
L'opération bloquerait alors que la socket est non-bloquante.
.TP
.B ESOCKTNOSUPPORT
La socket n'est pas configurée ou on a demandé un type inconnu.
.TP
.B EISCONN
On appelle
.BR connect (2)
sur une socket déjà connectée.
.TP
.B EALREADY
Une connexion est déjà en cours sur la socket non-bloquante.
.TP
.B ECONNABORTED
Une connexion a été refermée pendant la durée de
.BR accept (2). 
.TP
.B EPIPE
La connexion a été fermée par l'interlocuteur.
.TP
.B ENOENT
.B SIOCGSTAMP 
a été appelée sur une socket où aucun paquet n'est arrivé.
.TP
.B EHOSTUNREACH
Aucune entrée dans la table de routage ne correspond à l'adresse
de destination.
.TP
.B ENODEV 
Périphérique réseau non disponible ou incapable d'envoyer en IP.
.TP
.B ENOPKG 
Un sous-système du noyau n'est pas configuré.
.SH COMPATIBILITÉ
L'interface socket AppleTalk de base est compatible avec
.B netatalk 
sur les systèmes dérivés de BSD. Plusieurs systèmes BSD peuvent
échouer à vérifier
.B SO_BROADCAST
lorsqu'ils envoient des trames broadcast. Ceci peut poser des
problèmes de compatibilité.
.PP
Le mode socket
.B raw
est spécifique à Linux et existe pour supporter le paquetage
CAP et les outils de supervision AppleTalk plus facilement.
.SH BOGUES
Il y a trop de valeurs d'erreurs incohérentes.
.PP
Les ioctls utilisées pour configurer les tables de routage, les périphériques,
et les tables AARP ne sont pas décrites encore.
.SH "VOIR AUSSI"
.BR sendmsg (2), 
.BR recvmsg (2), 
.BR socket (7)
.SH TRADUCTION
Christophe Blaess, 2000-2003.


