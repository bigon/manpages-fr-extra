.\" Copyright (c) 1994, 1995 Jacques Gelinas (jacques@solucorp.qc.ca)
.\" Copyright (c) 1995, 1999 Bjorn Ekwall (bj0rn@blox.se)
.\" This program is distributed according to the Gnu General Public License.
.\" See the file COPYING in the base distribution directory
.\" MàJ 30/07/21 modutils-2.4.22
.TH DEPMOD 8 "30 juillet 2003" modutils "Manuel de l'administrateur Linux"
.SH NOM
depmod \- gestion des dépendances entre les modules du noyau.
.SH SYNOPSIS
.B depmod
[\-aA] [\-ehnqrsuvV]
.RI [\-C\  configfile "] [\-F\ " kernelsyms "] [\-b " basedirectory ]
.RI [ forced_version ]
.br
.B depmod \fR[\-enqrsuv] [\-F \fIkernelsyms\fR] module1.o module2.o ...
.SH DESCRIPTION
Les utilitaires
.B depmod
et
.B modprobe
ont été conçus pour rendre le noyau Linux
modulaire, configurable pour tous les utilisateurs,
administrateurs et concepteurs de distribution.
.PP
.B depmod
crée un fichier de dépendances type "Makefile", basé sur les symboles qu'il
trouve dans les modules indiqués sur la ligne de commande ou dans les
répertoires indiqués par le fichier de configuration.
Ce fichier est ensuite utilisé par
.B modprobe
pour charger automatiquement le module ou l'ensemble de modules corrects.
.PP
L'invocation normale de
.B depmod
se fait en incluant la ligne

.br 
.B "/sbin/depmod \-a"
.br

dans un fichier de démarrage
de
.IR /etc/rc.d ,
afin que les dépendances entre modules soient disponibles
immédiatement après le démarrage du système.
Notez que l'option
.B \-a
est maintenant facultative.
Pour le démarrage, l'option
.B \-q
peut s'avérer plus appropriée car elle permet de laisser depmod silencieux
malgré les symboles non résolus.
.PP
On peut aussi créer le fichier de dépendances immédiatement après avoir
compilé un nouveau noyau.
Si vous faites "\fBdepmod\ -a\ 2.4.21\fR" après avoir compilé le noyau
2.4.21 et ses modules pour la première fois, tout
en continuant de travailler avec par exemple le 2.4.20, le fichier sera
créé à l'emplacement adéquat.
Dans ce cas, toutefois les dépendances avec le nouveau
noyau ne sont pas garanties.
Voir les options
.BR \-F ", " \-C ", et " \-b
pour plus de détails sur ce problème.
.PP
Pour analyser les relations entre modules et symboles
exportés,
.B depmod
ne tient pas compte du status GPL des modules ou des symboles exportés.
Ceci signifie que depmod n'indiquera pas d'erreur si un module sans licence
compatible GPL fait référence à un symbole "GPL seulement" (EXPORT_SYMBOL_GPL
dans le noyau). Néanmoins insmod refusera de résoudre les symboles "GPL seulement"
pour les modules non-GPL et le véritable chargement échouera.
.SH OPTIONS
.TP
.BR \-a ", " \-\-all
Examine les modules dans tous les répertoires spécifiés dans le fichier
(facultatif) de configuration
.IR "/etc/modules.conf" .
.TP
.BR \-A ", " \-\-quick
Comparer les horodatades des fichiers, et au besoin agir comme
.BR "depmod \-a" .
Cette option ne met à jour le fichier de dépendance qu'en cas de changement.
.TP
.BR \-e ", " \-\-errsyms
Affiche tous les symboles non résolus pour chaque module.
.TP
.BR \-h ", " \-\-help
Affiche une page d'aide et se termine immédiatement.
.TP
.BR \-n ", " \-\-show
Affiche les dépendances sur la sortie standard plutôt que \fI/lib/modules\fR.
.TP
.BR \-q ", " \-\-quiet
Demande une exécution silencieuse sans compte-rendu des fonctions manquantes.
.TP
.BR \-r ", " \-\-root
Quelques utilisateurs compilent les modules sans droits root et les installent
en étant root. Ceci risque de créer des modules n'appartenant pas à root, même
si le répertoire des modules est propriété du root.
Si un tel compte utilisateur est piraté, un intrus peut modifier ces modules
et les utiliser pour obtenir un accès
root.
.TP
.I ""
Par défaut, modutils rejettera les demandes d'utilisation d'un module qui
n'appartient à root. L'option \fB-r\fR supprimera l'erreur et autorisera le
chargement de module n'appartenant pas à root.
.TP
.I ""
.B L'utilisation de -r est un danger pour la sécurité et est déconseillée.
.TP
.BR \-s ", " \-\-syslog
Envoie les messages d'erreurs au démon syslog plutôt que sur stderr.
.TP 
.BR \-u ", " \-\-unresolved-error
\fBdepmod\fR 2.4 ne donne pas de code de retour lorsqu'il y a des symboles non
résolus. La version majeure suivante de modutils (2.5) fournira un code pour
les symboles non-résolus. Certaines distributions préfèrent un code non-nul
dans modutils 2.4 mais ceci pose des problèmes avec les utilisateurs qui
comptent sur l'ancien comportement. Si vous voulez un code non-num pour depmod
2.4, indiquez \fB\-u\fR. \fBdepmod\fR 2.5 ignorera silencieusement l'option
\fB\-u\fR et renverra toujours un code non-nul en cas de symboles non
résolus;
.TP 
.BR \-v ", " \-\-verbose
Affiche le nom de chaque module traité.
.TP
.BR \-V ", " \-\-version
Affiche la version de \fBdepmod\fR.
.PP
Les options suivantes sont utiles aux développeurs ds distributions\ :
.TP
\fB\-b \fIbasedirectory\fR, \fB\-\-basedir \fIbasedirectory
Si l'arborescence sous
.I /lib/modules
contenant les modules est déplacée ailleurs pour gérer les modules dans
différents environnements, l'option
.B \-b
indique à depmod où trouver l'image déplacée de
l'arborescence
.IR /lib/modules .
Les noms indiqués dans le fichier 
.I modules.dep
créé par depmod, ne contiendront
pas
.IR basedirectory .
Cela signifie que l'arborescence
.I basedirectory/lib/modules
pourra se retrouver dans
.I /lib/modules
dans la distribution, avec toutes les références correctes.
.TP
\fB\-C \fIconfigfile\fR, \fB\-\-config \fIconfigfile
Utilise le fichier
.I configfile
plutôt que le fichier
.IR /etc/modules.conf .
La variable d'environnement
.B MODULECONF
peut aussi être utilisée pour sélectionner un fichier de configuration
différent de celui par défaut
.I /etc/modules.conf
ou
.I /etc/conf.modules
(déconseillé).
.TP
Quand la variable d'environnement
.B UNAME_MACHINE
est remplie, modutils l'utilisera à la place du champ "machine" de
l'appel-système uname(). Ceci est surtout utile si vous compilez des modules
64 bits dans un espace utilisateur 32 bits ou
inversement\ ; remplissez
.B UNAME_MACHINE
avec le type de modules construits.
La version actuelle de modutils ne supporte pas la construction croisée complète
de modules, elle est limitée au choix entre 32 et 64 bits de l'architecture
hôte.
.TP
\fB\-F kernelsyms\fR,\fB\-\-filesyms \fIkernelsyms
Quand on construit les fichiers des dépendances pour un noyau différent de
celui en cours d'utilisation, il est important que
.B depmod
utilise le bon jeu de fonctions pour trouver les références du noyau dans
chaque module.
Ces fonctions peuvent être une copie de 
.I System.map
provenant d'un autre noyau,
ou une copie de la sortie de
.IR /proc/ksyms .
Si votre noyau utilise des symboles avec numéros de version, il vaut mieux
utiliser une copie de la sortie de
.IR /proc/ksyms ,
car ce fichier contient les numéros de version des fonctions du noyau.
Toutefois, vous pouvez utiliser
.I System.map
même avec les numéros de version.
.SH CONFIGURATION
Le comportement de
.B depmod
et de
.B modprobe
peut être ajusté par le fichier (optionnel) de configuration
.B /etc/modules.conf
.br
Voir
.I modprobe(8)
et
.I modules.conf(5)
pour une description complète.
.PP
.SH STRATÉGIE
Chaque fois que vous compilez un noyau, la commande \fBmake modules_install\fP
créera un nouveau répertoire, mais ne changera pas le répertoire par défaut.
.PP
Quand vous avez un module non relié à la distribution du noyau, vous devez le
mettre dans un répertoire indépendant de la version
sous
.IR /lib/modules .
.PP
C'est la stratégie par défaut, laquelle peut être remplacée dans
.IR /etc/modules.conf .
.SH FICHIERS
.nf
.IR /etc/modules.conf\  "(aussi, mais déconseillé\ " /etc/conf.modules )
.IR /lib/modules/*/modules.dep ,
.I /lib/modules/*
.fi
.SH "VOIR AUSSI"
.BR modules.conf (5),
.BR modprobe (8),
.BR modinfo (8),
.BR lsmod (8),
.BR ksyms (8)
.SH BOGUES
\fBdepmod\fR [ \-V | \-\-version ] devrait se terminer immédiatement. En fait,
il affiche la version et se comporte comme s'il n'avait aucune option.
.SH AUTEURS
Jacques Gelinas (jack@solucorp.qc.ca)
.br
Bjorn Ekwall (bj0rn@blox.se)
.SH TRADUCTION
Jérome Signouret, 2000.
.br
Christophe Blaess, 2003.
