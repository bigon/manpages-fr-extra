.\" Copyright (c) 1998 Thorsten Kukuk (kukuk@vt.uni-paderborn.de)
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\"
.\" This manual page based on the GNU C Library info pages.
.\"
.\" Traduction 18/05/1998 par Christophe Blaess (ccb@club-internet.fr)
.\" (LDP-man-pages-1.19)
.\"
.TH NSSWITCH.CONF 5 "25 juillet 2003" LDP "Manuel de l administrateur Linux"
.SH NOM
nsswitch.conf \- Configuration des bases de données systèmes et des services de noms.
.SH DESCRIPTION
Plusieurs fonctions de la bibliothèque C doivent être configurées pour
fonctionner correctement dans l'environnement local. Traditionnellement,
cette configuration était établie par l'intermédiaire de fichiers
(comme `/etc/passwd'), mais de nouveaux services de résolution de noms
(comme le Network Information Service, NIS, ou le Domain Name Service DNS)
sont apparus, et ont été implémentés dans la bibliothèque C avec un ordre
de recherche fixé.
.LP
La bibliothèque libc5 de Linux implémentant NYS et la bibliothèque C GNU (libc.so.6)
fournissent une solution plus propre à ce problème. Elle a été construite à partir
d'une idée de Sun Microsystems, utilisée dans la bibliothèque C de Solaris 2. On a
conservé leur dénomination, et ce schéma est appelé "Name Service Switch" (NSS).
Les sources des bases de données, et leur ordre de recherche sont spécifiés dans
le fichier
.BR /etc/nsswitch.conf .
.LP
Les bases de données suivantes sont disponibles dans le NSS\ :
.TP
.B aliases
Les alias pour le courrier, utilisés par
.BR sendmail (8).
Ignorés de nos jours.
.TP
.B ethers
Les numéros Ethernet.
.TP
.B group
Les groupes d'utilisateur, servant aux fonctions
comme
.BR getgrent (3).
.TP
.B hosts
Les noms d'hôtes et leurs adresses, utilisés par les fonctions
du type
.BR gethostbyname (3).
.TP
.B netgroup
Une liste d'hôte et d'utilisateur servant aux règles d'accès.
Les bibliothèques C avant la GlibC 2.1 ne supportait ces groupes qu'avec NIS.
.TP
.B network
Les noms et les masques des réseaux, utilisés par les fonctions
comme
.BR getnetent (3).
.TP
.B passwd
Les mots de passe des utilisateurs, utilisés par les
fonctions
.BR getpwent (3).
.TP
.B protocols
Les protocoles réseau, utilisés
par
.BR getprotoent (3).
.TP
.B publickey
Les clés publiques et privées des secure_rpc, utilisées par NIS+ et NFS.
.TP
.B rpc
Les noms des procédures appelées à distance (RPC), utilisés par les fonctions
comme
.BR getrpcbyname (3).
.TP
.B services
Les services réseau, utilisés par les
fonctions
.BR getservent (3).
.TP
.B shadow
Le fichier de dissimulation des mots de passe des utilisateurs, utilisé par
.BR getspnam (3).
.LP
Un exemple de fichier
.B /etc/nsswitch.conf
pourrait être le suivant (ce sont les valeurs par défaut si
.B /etc/nsswitch.conf
manque)\ :
.sp 1n
.PD 0
.TP 16
passwd:
compat
.TP
group:
compat
.TP
shadow:
compat
.sp 1n
.TP
hosts:
dns [!UNAVAIL=return] files
.TP
networks:
nis [NOTFOUND=return] files
.TP
ethers:
nis [NOTFOUND=return] files
.TP
protocols:
nis [NOTFOUND=return] files
.TP
rpc:
nis [NOTFOUND=return] files
.TP
services:
nis [NOTFOUND=return] files
.PD
.LP
La première colonne, comme vous vous en doutez, correspond à la base de données
concernée, issue de la table indiquée plus haut.
Le reste de la ligne indique la méthode de recherche de cette base.
On peut indiquer une méthode différente pour chaque base de données.
.LP
La configuration de chaque base contient deux éléments différents:
.PD 0
.TP
* L'indication du service, comme `files', `db' ou `nis'.
.TP
* Le comportement à adopter pour la recherche, comme `[NOTFOUND=return]'.
.PD
.LP
Pour la bibliothèque libc5 avec NYS, les spécifications possibles pour le
service sont `files', `nis' et `nisplus'.
Pour les noms d'hôtes, vous pouvez ajouter un service supplémentaire `dns', et
pour les mots de passe et les groupes (mais pas pour la base de données shadow) vous
pouvez employer le service `compat'.
.LP
La bibliothèque C GNU nécessite un fichier appelé
.BI /lib/libnss_SERVICE.so. X
pour chaque SERVICE utilisé.
Avec une installation standard, vous pouvez utiliser `files', `db', `nis' et `nisplus'.
Pour les noms d'hôtes, vous pouvez indiquer `dns' comme service supplémentaire. Les mots
de passe, les groupes et la base de données shadow acceptent le service `compat'.
Ces services ne sont pas utilisés par la libC5 avec NYS. Le numéro de version
.I X
est 1 pour la GlibC 2.0 et 2 pour la GlibC 2.1.
.LP
Le second élément de la configuration fournit un contrôle plus fin sur la méthode de recherche.
Des actions sont indiquées, entre crochets, entre deux noms de services. La forme générale est la
suivante :
.LP
`[' ( `!'? STATUS `=' ACTION )+ `]'
.LP
avec
.sp 1n
.PD 0
.TP
STATUS => success | notfound | unavail | tryagain
.TP
ACTION => return | continue
.PD
.LP
Il n'y a pas de distinction majuscule/minuscule dans les mots-clés. Les valeurs
de STATUS correspondent au résultat d'une fonction de recherche pour un service particulier.
Ces mots-clés signifient :
.TP
.B success
Aucune erreur ne s'est produite, et la donnée recherchée a été trouvée. L'action par
défaut est `return'.
.TP
.B notfound
La méthode de recherche a bien fonctionné, mais la valeurs désirée n'a pas été trouvée.
L'action par défaut est `continue'.
.TP
.B unavail
Le service est indisponible, et ce de manière permanente. Ceci peut indiquer que le fichier
nécessaire n'existe pas, ou, pour les DNS, que le serveur n'accepte pas les requêtes.
L'action par défaut est `continue'.
.TP
.B tryagain
Le service considéré est temporairement indisponible. Ceci signifie qu'un fichier est 
verrouillé, et qu'un serveur ne peut pas accepter de connexion supplémentaire. L'action
par défaut est `continue'.
.LP
.SS Interactions avec la syntaxe +/- (mode compat)
La bibliothèque libc5 Linux sans NYS n'accepte pas le service de résolution de noms, mais
permet un contrôle d'accès.
Dans le fichier
.BR /etc/passwd ,
vous pouvez trouver des entrées de la forme +utilisateur ou +@groupe_reseau
(inclure l'utilisateur indiqué depuis le fichier NIS passwd), -utilisateur
ou -@groupe_réseau (exclure ces utilisateurs) et + (inclure tous les
utilisateurs depuis le fichier NIS passwd sauf les éventuels exclus explicites).
Comme la plupart des gens placent un + à la fin de
.B /etc/passwd
pour tout inclure depuis NIS, il est possible d'utiliser une méthode plus rapide
(`passwd: files nis') ne nécessitant pas d'entrée + dans
.BR /etc/passwd ,
.B /etc/group
et
.BR /etc/shadow .
Si ceci ne suffit pas, le service NSS `compat' autorise la sémantique +/- complète.
Par défaut, la source est `nis', mais on peut la surcharger en indiquant
`nisplus' comme source des pseudo-bases de données
.BR passwd_compat,
.B group_compat
et
.BR shadow_compat.
Ces pseudo-bases de données ne sont disponibles que dans la bibliothèque C GNU.
.SH FICHIERS
Un service appelé SERVICE est implémenté par une bibliothèque objet partagée nommée
.BI libnss_SERVICE.so. X
se trouvant dans
.IR /lib .
.TP 25
.PD 0
.B /etc/nsswitch.conf
fichier de configuration
.TP
.BI /lib/libnss_compat.so. X
la source `compat' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_db.so. X
la source `db' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_dns.so. X
la source `dns' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_files.so. X
la source `files' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_hesoid.so. X
la source `hesoid' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_nis.so. X
la source `nis' pour la bibliothèque GlibC 2\ ;
.TP
.BI /lib/libnss_nisplus.so. X
la source `nisplus' pour la bibliothèque GlibC 2.
.SH NOTES
Au sein de chaque processus qui utilise nsswitch.conf, la lecture
du fichier entier n'a lieu qu'une seule fois. Si le fichier est
modifié par la suite, le processus continuera à utiliser l'ancienne
configuration.
.LP
Avec Solaris il n'est pas possible de lier statiquement des programmes
utilisant les services NSS. Avec Linux cela ne pose aucun problème.
.SH TRADUCTION
Christophe Blaess, 1998-2003.
