.\" Copyright (C) 2003 Andries Brouwer (aeb@cwi.nl)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" The pathconf note is from Walter Harms
.\" This is not a system call on Linux
.\"
.\" Traduction : Alain Portal
.\" 27/06/2005 LDP-1.60
.\" Màj 20/07/2005 LDP-1.64
.\" Màj 14/12/2005 LDP-1.65
.\" Màj 01/05/2006 LDP-1.67.1
.\"
.TH STATVFS 2 "22 août 2003" "LDP" "Manuel du programmeur Linux"
.SH NOM
statvfs, fstatvfs \- obtenir les statistiques d'un système de fichier
.SH SYNOPSIS
.B #include <sys/statvfs.h>
.sp
.BI "int statvfs(const char *" path ", struct statvfs *" buf );
.br
.BI "int fstatvfs(int " fd ", struct statvfs *" buf );
.SH DESCRIPTION
La fonction
.B statvfs
retourne des informations sur un système de fichiers monté.
.I path
est un chemin vers n'importe quel fichier du système de fichiers monté.
.I buf
est un pointeur vers une structure
.I statvfs
approximativement définie comme ci\ :

.nf
  struct statvfs {
    unsigned long  f_bsize;    /* taille d'un bloc du système de fichiers */
    unsigned long  f_frsize;   /* taille d'un fragment */
    fsblkcnt_t     f_blocks;   /* taille du descripteur en unité f_frsize  */
    fsblkcnt_t     f_bfree;    /* # blocs libres */
    fsblkcnt_t     f_bavail;   /* # blocs libres pour non-root */
    fsfilcnt_t     f_files;    /* # inodes */
    fsfilcnt_t     f_ffree;    /* # inodes libres */
    fsfilcnt_t     f_favail;   /* # inodes libres pour non-root */
    unsigned long  f_fsid;     /* identifiant (id) du système de fichier */
    unsigned long  f_flag;     /* drapeaux de mount */
    unsigned long  f_namemax;  /* longueur maximum du nom de fchier */
  };
.fi

Les types
.B fsblkcnt_t
et
.B fsfilcnt_t
utilisés ici sont définis dans
.IR <sys/types.h> .
Both used to be
.BR "unsigned long" .

Le champ
.I f_flag
est un masque de bit (des drapeaux de mount, voir
.BR mount (8)).
Les bits définis par la spécification POSIX sont
.TP
.B ST_RDONLY
Système de fichiers en lecture seule.
.TP
.B ST_NOSUID
Les bits Set\-UID/Set\-UID sont ignorés par
.BR exec (2).
.LP

Il n'est pas spécifié si tous les membres de la structure retournée ont un
sens quelque soit le système de fichiers.

.B fstatvfs
renvoie la même information sur un fichier ouvert référencé par le descripteur
.IR fd .
.SH "VALEUR RENVOYÉE"
.B fstatvfs
renvoye zéro s'il réussit et \-1 en cas d'échec, auquel cas
.I errno
contient le code d'erreur.
.SH ERREURS
.TP
.B EBADF
(fstatvfs)
.I fd
n'est pas un descripteur de fichier ouvert valide.
.TP
.B EACCES
(statvfs)
Un élément du chemin d'accès
.IR path
ne permet pas le parcours.
.TP
.B ELOOP
(statvfs)
.IR path
contient une référence circulaire (à travers un lien symbolique).
.TP
.B ENAMETOOLONG
(statvfs)
.I path
est trop long.
.TP
.B ENOENT
(statvfs)
Le fichier indiqué par
.I path
n'existe pas.
.TP
.B ENOTDIR
(statvfs)
Un élément du chemin d'accès
.I path
n'est pas un répertoire.
.TP
.B EFAULT
.I Buf
ou
.I path
pointent en dehors de l'espace d'adressage accessible.
.TP
.B EINTR
Cet appel a été interrompu par un signal.
.TP
.B EIO
Une erreur d'entrée-sortie est survenue lors de la lecture sur le
système de fichiers.
.TP
.B ENOMEM
La mémoire mise à disposition par le noyau est insuffisante.
.TP
.B ENOSYS
Le système de fichiers ne supporte pas cet appel.
.TP
.B EOVERFLOW
Certaines valeurs sont tros grandes pour être représentées dans la
structure renvoyée.
.PP
.SH "CONFORMITÉ"
Solaris, Irix, POSIX 1003.1-2001
.SH NOTES
Le noyau Linux a les appels système statfs et fstatfs pour supporter
cet appel.

L'implémentation de
.sp
.nf
   pathconf(path, _PC_REC_XFER_ALIGN);
   pathconf(path, _PC_ALLOC_SIZE_MIN);
   pathconf(path, _PC_REC_MIN_XFER_SIZE);
.fi
.sp
dans la glibc courante utilise les champs
.IR f_frsize ,
.IR f_frsize ,
et
.IR f_bsize
de la valeur de retour de
.IR "statvfs(path,buf)" .
.SH "VOIR AUSSI"
.BR statfs (2)

.SH TRADUCTION
.PP
Ce document est une traduction réalisée par Alain Portal
<aportal AT univ-montp2 DOT fr> le 27\ juin\ 2005
et révisée le 2\ mai\ 2006.
.PP
L'équipe de traduction a fait le maximum pour réaliser une adaptation
française de qualité. La version anglaise la plus à jour de ce document est
toujours consultable via la commande\ : «\ \fBLANG=en\ man\ 2\ statvfs\fR\ ».
N'hésitez pas à signaler à l'auteur ou au traducteur, selon le cas, toute
erreur dans cette page de manuel.

