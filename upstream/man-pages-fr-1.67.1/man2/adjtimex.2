.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (c) 1995 Michael Chastain (mec@shell.portal.com), 15 April 1995.
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\"
.\" Modified Fri Jan 31 16:11:17 1997 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified Wed Jul 30 14:25:16 1997 by Paul Slootman <paul@wurtel.demon.nl>
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\" Màj 09/12/1997 LDP-1.18
.\" Màj 30/05/2001 LDP-1.36
.\" Màj 18/07/2003 LDP-1.56
.\" Màj 01/05/2006 LDP-1.67.1
.\"
.TH ADJTIMEX 2 "18 juillet 2003" LDP "Manuel du programmeur Linux"
.SH NOM
adjtimex \- Régler l'horloge du noyau (kernel clock).
.SH SYNOPSIS
.B #include <sys/timex.h>
.sp
.BI "int adjtimex(struct timex *" "buf" );
.SH DESCRIPTION
Linux utilise l'algorithme d'ajustement d'horloge de David L. Mills (RFC 1305).
L'appel système
.B adjtimex
lit, et écrit éventuellement les paramètres d'ajustement pour cet algorithme.
Il utilise un pointeur sur une structure
.I timex
pour mettre à jour les paramètres du noyau avec les valeurs de ses champs,
et renvoyer la même structure avec les valeurs actuelles du noyau.
La structure est déclarée comme suit
.PP
.RS
.nf
struct timex {
    int modes;           /* mode selector */
    long offset;         /* time offset (usec) */
    long freq;           /* frequency offset (scaled ppm) */
    long maxerror;       /* maximum error (usec) */
    long esterror;       /* estimated error (usec) */
    int status;          /* clock command/status */
    long constant;       /* pll time constant */
    long precision;      /* clock precision (usec) (read only) */
    long tolerance;      /* clock frequency tolerance (ppm)
                            (read only) */
    struct timeval time; /* current time (read only) */
    long tick;           /* usecs between clock ticks */
};
.fi
.RE
.PP
Le champ
.I modes
détermine les paramètres éventuels à écrire.
Il contient un
.RI OU
binaire «\ |\ » entre les valeurs suivantes\ :
.PP
.RS
.nf
#define ADJ_OFFSET            0x0001 /* time offset */
#define ADJ_FREQUENCY         0x0002 /* frequency offset */
#define ADJ_MAXERROR          0x0004 /* maximum time error */
#define ADJ_ESTERROR          0x0008 /* estimated time error */
#define ADJ_STATUS            0x0010 /* clock status */
#define ADJ_TIMECONST         0x0020 /* pll time constant */
#define ADJ_TICK              0x4000 /* tick value */
#define ADJ_OFFSET_SINGLESHOT 0x8001 /* old-fashioned adjtime */
.fi
.RE
.PP
Les utilisateurs normaux sont limités à une valeur de
.IR mode
nulle, seul le super-utilisateur peut écrire les paramètres.
.br
.ne 12v
.SH "VALEUR RENVOYÉE"
S'il réussit,
.B adjtimex
renvoie l'état de l'horloge\ :
.PP
.RS
.nf
#define TIME_OK   0 /* clock synchronized */
#define TIME_INS  1 /* insert leap second */
#define TIME_DEL  2 /* delete leap second */
#define TIME_OOP  3 /* leap second in progress */
#define TIME_WAIT 4 /* leap second has occurred */
#define TIME_BAD  5 /* clock not synchronized */
.fi
.RE
.PP
En cas d'échec
.B adjtimex
renvoie \-1 et remplit
.IR errno .
.SH ERREURS
.TP
.B EFAULT
.I buf
pointe en dehors de l'espace d'adressage accessible.
.TP
.B EPERM
.I buf.mode
est non nul, et l'utilisateur n'est pas super-utilisateur.
.TP
.B EINVAL
Une tentative est faite de remplir
.I buf.offset
en dehors de l'intervalle \-131071 à +131071,
ou de mettre
.I buf.status
a une valeur autre que celle listée ci-dessus,
ou
.I buf.tick
en dehors de l'intervalle
.RB 900000/ HZ
à
.RB 1100000/ HZ ,
où
.B HZ
est la fréquence d'interruption de l'horloge système.
.SH "CONFORMITÉ"
\fBadjtimex\fP est spécifique à Linux, et ne doit pas être employé dans des
programmes destinés à être portés sur d'autres systèmes. Un appel
\fBadjtime\fP moins général existe sous SVr4.
.SH "VOIR AUSSI"
.BR settimeofday (2).
.SH TRADUCTION
.PP
Ce document est une traduction réalisée par Christophe Blaess
<http://www.blaess.fr/christophe/> le 14\ octobre\ 1996
et révisée le 2\ mai\ 2006.
.PP
L'équipe de traduction a fait le maximum pour réaliser une adaptation
française de qualité. La version anglaise la plus à jour de ce document est
toujours consultable via la commande\ : «\ \fBLANG=en\ man\ 2\ adjtimex\fR\ ».
N'hésitez pas à signaler à l'auteur ou au traducteur, selon le cas, toute
erreur dans cette page de manuel.
