.\" Copyright 1997 Nicolás Lichtmaier <nick@debian.org>
.\" Created Thu Aug  7 00:44:00 ART 1997
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" Added section stuff, aeb, 2002-04-22.
.\" Corrected include file, drepper, 2003-06-15.
.\"
.\" Traduction 31/08/2000 par Christophe Blaess (ccb@club-internet.fr)
.\" LDP 1.31
.\" Màj 21/07/2003 LDP-1.57
.\" Màj 01/05/2006 LDP-1.67.1
.\"
.TH LOCKF 3 "22 avril 2002" LDP "Manuel du programmeur Linux"
.SH NOM
lockf \- Poser, examiner ou supprimer un verrou POSIX sur un fichier ouvert.
.SH SYNOPSIS
.B #include <unistd.h>
.sp
.BR "int lockf(int " fd ", int " cmd ", off_t " len );
.SH DESCRIPTION
Cette fonction pose, examine, ou supprime un verrou POSIX sur un fichier ouvert.
Le fichier est indiqué par
.IR fd ,
un descripteur ouvert en écriture, l'action par
.IR cmd ,
et la section par les octets aux positions
.IR pos .. pos + len \-1
si len est positive et
.IR pos - len .. pos \-1
si len est négative, où
.I pos
est la position actuelle dans le fichier. Si
.I len
vaut zéro, la section s'étend de la position courant à l'infini, englobant
la fin-de-fichier et les extensions ultérieures.
Dans tous les cas, la section peut s'étendre au-delà de la fin du fichier.
.LP
Sous Linux, cette fonction est juste une interface pour l'appel système
.BR fcntl (2).
(En général, les relations entre
.BR lockf ()
et
.BR fcntl ()
sont indéterminées).
.LP
Les opérations valides sont les suivantes\ :
.TP
.B F_LOCK
Poser un verrou exclusif sur la section indiquée du fichier.
Si (une partie de) la section est déjà verrouillée, l'appel bloque jusqu'à la
suppression du verrou précédent.
Si la section recouvre un verrou existant (du même processus), les deux sont
regroupés.
Les verrouillages sont libérés lorsque le processus ferme un descripteur du
fichier.
Un processus fils n'hérite pas du verrou.
.TP
.B F_TLOCK
Comme
.B F_LOCK
mais l'appel n'est pas bloquant, il renvoie une erreur si le fichier est
déjà verrouillé.
.TP
.B F_ULOCK
Déverrouiller la section indiquée du fichier. Ceci peut conduire une section
verrouillée à être découpée en deux sections.
.TP
.B F_TEST
Vérifier s'il y a un verrou\ : l'appel renvoie 0 si la section indiquée est
libre ou verrouillée par le processus appelant, et \-1 avec
.B EACCES
dans
.I errno
si un autre processus possède le verrou.
.SH "VALEUR RENVOYÉE"
Si elle réussit, cette fonction renvoie 0. En cas d'erreur, elle renvoie \-1 et
remplit
.I errno
en conséquence.
.SH ERREURS
.TP
.B EAGAIN
Le fichier est verrouillé et
.B F_TLOCK
ou
.B F_TEST
étaient indiqués, ou encore l'opération est impossible car le fichier est
projetée dans la mémoire d'un autre processus.
.TP
.B EBADF
.I fd
n'est pas un descripteur valide.
.TP
.B EDEADLK
L'opération
.B T_LOCK
demandée amènerait à un cas de blocage.
.TP
.B EINVAL
Une opération invalide a été réclamée sur
.IR fd .
.TP
.B ENOLCK
La table des verrous est pleine.
.SH CONFORMITÉ
SYSV,  POSIX 1003.1-2001
.SH "VOIR AUSSI"
.BR fcntl (2),
.BR flock (2)
.br
On peut aussi examiner
.I locks.txt
et
.I mandatory.txt
dans la documentation Linux
.IR /usr/src/linux/Documentation .
.SH TRADUCTION
.PP
Ce document est une traduction réalisée par Christophe Blaess
<http://www.blaess.fr/christophe/> le 31\ août\ 2000
et révisée le 2\ mai\ 2006.
.PP
L'équipe de traduction a fait le maximum pour réaliser une adaptation
française de qualité. La version anglaise la plus à jour de ce document est
toujours consultable via la commande\ : «\ \fBLANG=en\ man\ 3\ lockf\fR\ ».
N'hésitez pas à signaler à l'auteur ou au traducteur, selon le cas, toute
erreur dans cette page de manuel.
