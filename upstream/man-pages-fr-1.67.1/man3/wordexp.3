.\" Copyright (c) 2003 Andries Brouwer (aeb@cwi.nl)
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111,
.\" USA.
.\"
.\" Traduction : Alain Portal
.\" 04/07/2005 LDP-1.61
.\" Màj 14/12/2005 LDP-1.65
.\" Màj 01/05/2006 LDP-1.67.1
.\"
.TH WORDEXP 3 "11 novembre 2003"  "" "Manuel du programmeur Linux"
.SH "NOM"
wordexp, wordfree \- Effectuer l'expansion de mots à la manière d'un shell POSIX.
.SH SYNOPSIS
.sp
.B "#include <wordexp.h>"
.sp
.BI "int wordexp(const char *" s ", wordexp_t *" p ", int " flags );
.sp
.BI "void wordfree(wordexp_t *" p );
.sp
.SH DESCRIPTION
La fonction
.BR wordexp ()
effectue une expansion de type shell de la chaîne
.I s
et retourne le résultat dans la structure pointée par
.IR p .
Le type de données
.B wordexp_t
est une structure qui possède au moins les membres
.IR we_wordc ,
.IR we_wordv ,
et
.IR we_offs .
Le membre
.I we_wordc
est de type
.B size_t
et donne le nombre de mots dans l'expansion de
.IR s .
Le membre
.I we_wordv
est de type
.B char **
et pointe sur le tableau des mots trouvés.
Le membre
.I we_offs
de type
.B size_t
est quelquefois (suivant
.IR flags ,
voir plus loin) utilisé pour indiquer le nombre d'éléments du tableau
.I we_wordv
qui devraient être remplis initialement avec le caractère NULL.
.LP
La fonction
.BR wordfree ()
libère la mémoire nouvellement allouée. Plus précisément, elle ne libère pas
son argument mais libère le tableau
.I we_wordv
ainsi que les chaînes vers lesquelles il pointe.

.SH "EXEMPLE"
D'abord un petit exemple. La sortie est approximativement celle de
«\ ls [a-c]*.c\ ».
.LP
.nf
#include <stdio.h>
#include <wordexp.h>

int main(int argc, char **argv) {
        wordexp_t p;
        char **w;
        int i;

        wordexp("[a-c]*.c", &p, 0);
        w = p.we_wordv;
        for (i=0; i<p.we_wordc; i++)
                printf("%s\en", w[i]);
        wordfree(&p);
        return 0;
}
.fi
.SH DÉTAILS
.SS "L'argument chaîne"
Puisque l'expansion est effectuée de la même manière que par le shell (voir
.BR sh (1))
sur les paramètres d'une commande, la chaîne
.I s
ne doit pas contenir de caractères qui seraient illégaux dans les paramètres
d'une commande shell. En particulier, il ne doit pas y avoir de caractères
nouvelle ligne ou |, &, ;, <, >, (, ), {, } non protégés (banalisés) en dehors
d'un contexte de substitution de commande ou de substitution de paramètres.
.LP
Si l'argument
.I s
contient un mot qui débute par un caractère de commentaires # hors de tous
guillemets, il n'est pas spécifié si ce mot et les suivants sont ignorés ou
si le # est considéré comme un caractère normal (Ndt\ : donc pas comme le
caractère qui indique que ce qui le suit doit être considéré comme du
commentaire).

.SS "L'expansion"
L'expansion effectuée consiste en les étapes suivantes\ :
expansion du caractère tilde (remplacement de ~utilisateur par le répertoire
personnel de l'utilisateur), substitution de variable (remplacement de $FOO
par la valeur de la variable d'environnement FOO), substitution de commande
(remplacement de $(commande) ou `commande` par la sortie de la commande),
expansion arithmétique, découpage de champs, expansion des caractères de
remplacement (wildcard), suppression des caractères de citation.
.LP
Le résultat de l'expansion de caractères spéciaux
($@, $*, $#, $?, $-, $$, $!, $0) n'est pas spécifié.
.LP
Le splittage de champs est effectué en utilisant la variable d'environnement
$IFS. Si elle n'est pas positionnée, les séparateurs de champs sont l'espace,
la tabulation et le caractère nouvelle ligne.

.SS "Le tableau de sortie"
Le tableau
.I we_wordv
contient les mots trouvés, suivi par le caractère NULL.

.SS "L'argument flags"
L'argument
.I flag
est un OU inclusif bit à bit des valeurs suivantes\ :
.TP
.B WRDE_APPEND
Ajouter les mots trouvés au tableau résultant d'un précédent appel.
.TP
.B  WRDE_DOOFFS
Insérer
.I we_offs
caractères initiaux NULL dans le tableau
.IR we_wordv .
(Ils ne seront pas comptés dans le membre
.I we_wordc
retourné.)
.TP
.B  WRDE_NOCMD
Ne pas effectuer la substitution de commande.
.TP
.B WRDE_REUSE
Le paramètre
.I p
résultant d'un précédent appel à
.BR wordexp (),
et
.BR wordfree ()
n'a pas été appelé. Réutiliser l'espace de stockage alloué.
.TP
.B WRDE_SHOWERR
Normalement, lors d'une substitution de commande
.I stderr
est redirigée vers
.IR /dev/null .
Ce drapeau spécifie que
.I stderr
ne sera pas redirigé.
.TP
.B WRDE_UNDEF
Considérer comme une erreur le fait qu'une variable shell non définie soit
expansée.
.SH "VALEUR RENVOYÉE"
Si elle réussit, la fonction renvoie 0. Si elle échoue, elle renvoie l'une
des cinq valeurs suivantes.
.TP
.B WRDE_BADCHAR
Occurence illégale d'un caractère nouvelle ligne ou d'un caractère parmi
|, &, ;, <, >, (, ), {, }.
.TP
.B WRDE_BADVAL
Il y a une référence à une variable shell non définie, et le drapeau
WRDE_UNDEF nous demande de considérer que c'est une erreur.
.TP
.B WRDE_CMDSUB
Une substitution de commande est apparue, et le drapeau WRDE_NOCMD nous
demande de considérer que c'est une erreur.
.TP
.B WRDE_NOSPACE
Pas assez de mémoire.
.TP
.B WRDE_SYNTAX
Erreur de syntaxe shell, comme des parenthèses ou des guillemets non
appareillés.
.SH "CONFORMITÉ"
XPG4, POSIX 1003.1-2003
.SH "VOIR AUSSI"
.BR fnmatch (3),
.BR glob (3)
.SH TRADUCTION
.PP
Ce document est une traduction réalisée par Alain Portal
<aportal AT univ-montp2 DOT fr> le 4\ juillet\ 2005
et révisée le 2\ mai\ 2006.
.PP
L'équipe de traduction a fait le maximum pour réaliser une adaptation
française de qualité. La version anglaise la plus à jour de ce document est
toujours consultable via la commande\ : «\ \fBLANG=en\ man\ 3\ wordexp\fR\ ».
N'hésitez pas à signaler à l'auteur ou au traducteur, selon le cas, toute
erreur dans cette page de manuel.
